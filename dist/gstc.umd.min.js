/**
 * Gantt-Schedule-Timeline-Calendar
 *
 * @copyright NEURONET - Rafal Pospiech <https://neuronet.io>
 * @author    Rafal Pospiech <neuronet.io@gmail.com>
 * @package   gantt-schedule-timeline-calendar
 * @license   NEURONET Free License (see https://github.com/neuronetio/gantt-schedule-timeline-calendar/blob/master/LICENSE)
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).GSTC={})}(this,(function(t){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function createCommonjsModule(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}createCommonjsModule((function(t,e){
/*!
	 * PEP v0.5.1 | https://github.com/jquery/PEP
	 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
	 */
t.exports=function(){var t=["bubbles","cancelable","view","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],e=[!1,!1,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function PointerEvent(n,i){i=i||Object.create(null);var s=document.createEvent("Event");s.initEvent(n,i.bubbles||!1,i.cancelable||!1);for(var o,r=2;r<t.length;r++)s[o=t[r]]=i[o]||e[r];s.buttons=i.buttons||0;var a=0;return a=void 0!==i.pressure&&s.buttons?i.pressure:s.buttons?.5:0,s.x=s.clientX,s.y=s.clientY,s.pointerId=i.pointerId||0,s.width=i.width||1,s.height=i.height||1,s.pressure=a,s.tiltX=i.tiltX||0,s.tiltY=i.tiltY||0,s.twist=i.twist||0,s.tangentialPressure=i.tangentialPressure||0,s.pointerType=i.pointerType||"",s.hwTimestamp=i.hwTimestamp||0,s.isPrimary=i.isPrimary||!1,s.detail=0,s}var n=window.Map&&window.Map.prototype.forEach?Map:SparseArrayMap;function SparseArrayMap(){this.array=[],this.size=0}SparseArrayMap.prototype={set:function(t,e){if(void 0===e)return this.delete(t);this.has(t)||this.size++,this.array[t]=e},has:function(t){return void 0!==this.array[t]},delete:function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.array.length=0,this.size=0},forEach:function(t,e){return this.array.forEach((function(n,i){t.call(e,n,i,this)}),this)}};var i=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],s=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],o={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},r="undefined"!=typeof SVGElementInstance,a={pointermap:new n,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(t,e){var n=e,i=n.events;i&&(i.forEach((function(t){n[t]&&(this.eventMap[t]=n[t].bind(n))}),this),this.eventSources[t]=n,this.eventSourceList.push(n))},register:function(t){for(var e,n=this.eventSourceList.length,i=0;i<n&&(e=this.eventSourceList[i]);i++)e.register.call(e,t)},unregister:function(t){for(var e,n=this.eventSourceList.length,i=0;i<n&&(e=this.eventSourceList[i]);i++)e.unregister.call(e,t)},contains:function(t,e){try{return t.contains(e)}catch(t){return!1}},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){t.bubbles=!1,this.fireEvent("pointerenter",t)},leave:function(t){t.bubbles=!1,this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.propagate(t,this.leave,!1)},enterOver:function(t){this.over(t),this.propagate(t,this.enter,!0)},eventHandler:function(t){if(!t._handledByPE){var e=t.type,n=this.eventMap&&this.eventMap[e];n&&n(t),t._handledByPE=!0}},listen:function(t,e){e.forEach((function(e){this.addEvent(t,e)}),this)},unlisten:function(t,e){e.forEach((function(e){this.removeEvent(t,e)}),this)},addEvent:function(t,e){t.addEventListener(e,this.boundHandler)},removeEvent:function(t,e){t.removeEventListener(e,this.boundHandler)},makeEvent:function(t,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);var n=new PointerEvent(t,e);return e.preventDefault&&(n.preventDefault=e.preventDefault),n._target=n._target||e.target,n},fireEvent:function(t,e){var n=this.makeEvent(t,e);return this.dispatchEvent(n)},cloneEvent:function(t){for(var e,n=Object.create(null),o=0;o<i.length;o++)n[e=i[o]]=t[e]||s[o],!r||"target"!==e&&"relatedTarget"!==e||n[e]instanceof SVGElementInstance&&(n[e]=n[e].correspondingUseElement);return t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n},getTarget:function(t){var e=this.captureInfo[t.pointerId];return e?t._target!==e&&t.type in o?void 0:e:t._target},propagate:function(t,e,n){for(var i=t.target,s=[];null!=i&&i!==document&&!i.contains(t.relatedTarget);)if(s.push(i),!(i=i.parentNode))return;n&&s.reverse(),s.forEach((function(n){t.target=n,e.call(this,t)}),this)},setCapture:function(t,e,n){this.captureInfo[t]&&this.releaseCapture(t,n),this.captureInfo[t]=e,this.implicitRelease=this.releaseCapture.bind(this,t,n),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var i=new PointerEvent("gotpointercapture",{bubbles:!0});i.pointerId=t,i._target=e,n||this.asyncDispatchEvent(i)},releaseCapture:function(t,e){var n=this.captureInfo[t];if(n){this.captureInfo[t]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var i=new PointerEvent("lostpointercapture",{bubbles:!0});i.pointerId=t,i._target=n,e||this.asyncDispatchEvent(i)}},dispatchEvent:function(t){var e=this.getTarget(t);if(e)return e.dispatchEvent(t)},asyncDispatchEvent:function(t){requestAnimationFrame(this.dispatchEvent.bind(this,t))}};a.boundHandler=a.eventHandler.bind(a);var l={shadow:function(t){if(t)return t.shadowRoot||t.webkitShadowRoot},canTarget:function(t){return t&&Boolean(t.elementFromPoint)},targetingShadow:function(t){var e=this.shadow(t);if(this.canTarget(e))return e},olderShadow:function(t){var e=t.olderShadowRoot;if(!e){var n=t.querySelector("shadow");n&&(e=n.olderShadowRoot)}return e},allShadows:function(t){for(var e=[],n=this.shadow(t);n;)e.push(n),n=this.olderShadow(n);return e},searchRoot:function(t,e,n){if(t){var i,s,o=t.elementFromPoint(e,n);for(s=this.targetingShadow(o);s;){if(i=s.elementFromPoint(e,n)){var r=this.targetingShadow(i);return this.searchRoot(r,e,n)||i}s=this.olderShadow(s)}return o}},owner:function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(e=document),e},findTarget:function(t){var e=t.clientX,n=t.clientY,i=this.owner(t.target);return i.elementFromPoint(e,n)||(i=document),this.searchRoot(i,e,n)}},h=Array.prototype.forEach.call.bind(Array.prototype.forEach),u=Array.prototype.map.call.bind(Array.prototype.map),m=Array.prototype.slice.call.bind(Array.prototype.slice),p=Array.prototype.filter.call.bind(Array.prototype.filter),f=window.MutationObserver||window.WebKitMutationObserver,v={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function Installer(t,e,n,i){this.addCallback=t.bind(i),this.removeCallback=e.bind(i),this.changedCallback=n.bind(i),f&&(this.observer=new f(this.mutationWatcher.bind(this)))}function rule(t){return"{ -ms-touch-action: "+t+"; touch-action: "+t+"; }"}Installer.prototype={watchSubtree:function(t){this.observer&&l.canTarget(t)&&this.observer.observe(t,v)},enableOnSubtree:function(t){this.watchSubtree(t),t===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(t)},installNewSubtree:function(t){h(this.findElements(t),this.addElement,this)},findElements:function(t){return t.querySelectorAll?t.querySelectorAll("[touch-action]"):[]},removeElement:function(t){this.removeCallback(t)},addElement:function(t){this.addCallback(t)},elementChanged:function(t,e){this.changedCallback(t,e)},concatLists:function(t,e){return t.concat(m(e))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(t){return t.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(t){var e=u(t,this.findElements,this);return e.push(p(t,this.isElement)),e.reduce(this.concatLists,[])},mutationWatcher:function(t){t.forEach(this.mutationHandler,this)},mutationHandler:function(t){"childList"===t.type?(this.flattenMutationTree(t.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(t.removedNodes).forEach(this.removeElement,this)):"attributes"===t.type&&this.elementChanged(t.target,t.oldValue)}};var b=[{selector:'[touch-action="none"]',value:"none"},{selector:'[touch-action="auto"]',value:"auto"},{selector:'[touch-action~="pan-x"]',value:"pan-x"},{selector:'[touch-action~="pan-y"]',value:"pan-y"},{selector:'[touch-action~="pan-up"]',value:"pan-up"},{selector:'[touch-action~="pan-down"]',value:"pan-down"},{selector:'[touch-action~="pan-left"]',value:"pan-left"},{selector:'[touch-action~="pan-right"]',value:"pan-right"}],w="",x=window.PointerEvent||window.MSPointerEvent,P=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,C=a.pointermap,D=[1,4,2,8,16],S=!1;try{S=1===new MouseEvent("test",{buttons:1}).buttons}catch(t){}var I,T={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","webkitmouseforcechanged","mousemove","mouseup","mouseover","mouseout"],register:function(t){a.listen(t,this.events)},unregister:function(t){a.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){for(var e,n=this.lastTouches,i=t.clientX,s=t.clientY,o=0,r=n.length;o<r&&(e=n[o]);o++){var a=Math.abs(i-e.x),l=Math.abs(s-e.y);if(a<=25&&l<=25)return!0}},prepareEvent:function(t){var e=a.cloneEvent(t),n=e.preventDefault;return e.preventDefault=function(){t.preventDefault(),n()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,"webkitForce"in t&&(e.pressure=t.webkitForce-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN),e},prepareButtonsForMove:function(t,e){var n=C.get(this.POINTER_ID);0!==e.which&&n?t.buttons=n.buttons:t.buttons=0,e.buttons=t.buttons},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=C.get(this.POINTER_ID),n=this.prepareEvent(t);S||(n.buttons=D[n.button],e&&(n.buttons|=e.buttons),t.buttons=n.buttons),C.set(this.POINTER_ID,t),e&&0!==e.buttons?a.move(n):a.down(n)}},webkitmouseforcechanged:function(t){this.mousemove(t)},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);S||this.prepareButtonsForMove(e,t),e.button=-1,C.set(this.POINTER_ID,t),a.move(e)}},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=C.get(this.POINTER_ID),n=this.prepareEvent(t);if(!S){var i=D[n.button];n.buttons=e?e.buttons&~i:0,t.buttons=n.buttons}C.set(this.POINTER_ID,t),n.buttons&=~D[n.button],0===n.buttons?a.up(n):a.move(n)}},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);S||this.prepareButtonsForMove(e,t),e.button=-1,C.set(this.POINTER_ID,t),a.enterOver(e)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);S||this.prepareButtonsForMove(e,t),e.button=-1,a.leaveOut(e)}},cancel:function(t){var e=this.prepareEvent(t);a.cancel(e),this.deactivateMouse()},deactivateMouse:function(){C.delete(this.POINTER_ID)}},O=a.captureInfo,_=l.findTarget.bind(l),E=l.allShadows.bind(l),R=a.pointermap,A={events:["touchstart","touchmove","touchforcechange","touchend","touchcancel"],register:function(t){I.enableOnSubtree(t)},unregister:function(){},elementAdded:function(t){var e=t.getAttribute("touch-action"),n=this.touchActionToScrollType(e);"number"==typeof n&&(t._scrollType=n,a.listen(t,this.events),E(t).forEach((function(t){t._scrollType=n,a.listen(t,this.events)}),this))},elementRemoved:function(t){if(R.size>0){var e=this.events;t.addEventListener("touchend",(function(){t._scrollType=void 0,a.unlisten(t,e)}))}else t._scrollType=void 0,a.unlisten(t,this.events);E(t).forEach((function(t){t._scrollType=void 0,a.unlisten(t,this.events)}),this)},elementChanged:function(t,e){var n=t.getAttribute("touch-action"),i=this.touchActionToScrollType(n),s=this.touchActionToScrollType(e);"number"==typeof i&&"number"==typeof s?(t._scrollType=i,E(t).forEach((function(t){t._scrollType=i}),this)):"number"==typeof s?this.elementRemoved(t):"number"==typeof i&&this.elementAdded(t)},scrollTypes:{UP:function(t){return t.includes("pan-y")||t.includes("pan-up")?1:0},DOWN:function(t){return t.includes("pan-y")||t.includes("pan-down")?2:0},LEFT:function(t){return t.includes("pan-x")||t.includes("pan-left")?4:0},RIGHT:function(t){return t.includes("pan-x")||t.includes("pan-right")?8:0}},touchActionToScrollType:function(t){if(t){if("auto"===t)return 15;if("none"===t)return 0;var e=t.split(" "),n=this.scrollTypes;return n.UP(e)|n.DOWN(e)|n.LEFT(e)|n.RIGHT(e)}},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===R.size||1===R.size&&R.has(1))&&(this.firstTouch=t.identifier,this.firstXY={X:t.clientX,Y:t.clientY},this.scrolling=!1)},removePrimaryPointer:function(t){t.isPrimary&&(this.firstTouch=null,this.firstXY=null)},typeToButtons:function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t&&"touchforcechange"!==t||(e=1),e},touchToPointer:function(t){var e=this.currentTouchEvent,n=a.cloneEvent(t),i=n.pointerId=t.identifier+2;if(n.target=O[i]||_(n),n.bubbles=!0,n.cancelable=!0,n.button=0,n.buttons=this.typeToButtons(e.type),n.width=2*(t.radiusX||t.webkitRadiusX||0),n.height=2*(t.radiusY||t.webkitRadiusY||0),n.pressure=void 0!==t.force?t.force:void 0!==t.webkitForce?t.webkitForce:void 0,n.isPrimary=this.isPrimaryTouch(t),t.altitudeAngle){const e=Math.tan(t.altitudeAngle),i=180/Math.PI;n.tiltX=Math.atan(Math.cos(t.azimuthAngle)/e)*i,n.tiltY=Math.atan(Math.sin(t.azimuthAngle)/e)*i}else n.tiltX=0,n.tiltY=0;"stylus"===t.touchType?n.pointerType="pen":n.pointerType=this.POINTER_TYPE,n.altKey=e.altKey,n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.shiftKey=e.shiftKey;var s=this;return n.preventDefault=function(){s.scrolling=!1,s.firstXY=null,e.preventDefault()},n},processTouches:function(t,e){var n=t.changedTouches;this.currentTouchEvent=t;for(var i,s=0;s<n.length;s++)i=n[s],e.call(this,this.touchToPointer(i))},shouldScroll:function(t){if(this.firstXY){var e,n=t.currentTarget._scrollType;if(0===n)e=!1;else if(15===n)e=!0;else{var i=t.changedTouches[0],s=i.clientY-this.firstXY.Y,o=Math.abs(s),r=i.clientX-this.firstXY.X,a=Math.abs(r),l=1&n,h=2&n,u=4&n,m=8&n;u&&m?e=a>o:u?e=a>o&&r>0:m&&(e=a>o&&r<0),e||(l&&h?e=a<o:l?e=a<o&&s>0:h&&(e=a<o&&s<0))}return this.firstXY=null,e}},findTouch:function(t,e){for(var n,i=0,s=t.length;i<s&&(n=t[i]);i++)if(n.identifier===e)return!0},vacuumTouches:function(t){var e=t.touches;if(R.size>=e.length){var n=[];R.forEach((function(t,i){if(1!==i&&!this.findTouch(e,i-2)){var s=t.out;n.push(s)}}),this),n.forEach(this.cancelOut,this)}},touchstart:function(t){this.vacuumTouches(t),this.setPrimaryTouch(t.changedTouches[0]),this.dedupSynthMouse(t),this.scrolling||this.processTouches(t,this.overDown)},overDown:function(t){R.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),a.enterOver(t),a.down(t)},touchforcechange:function(t){this.touchmove(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=t,n=R.get(e.pointerId);if(n){var i=n.out,s=n.outTarget;a.move(e),i&&s!==e.target&&(i.relatedTarget=e.target,e.relatedTarget=s,i.target=s,e.target?(a.leaveOut(i),a.enterOver(e)):(e.target=s,e.relatedTarget=null,this.cancelOut(e))),n.out=e,n.outTarget=e.target}},touchend:function(t){this.dedupSynthMouse(t),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(a.up(t),a.leaveOut(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){a.cancel(t),a.leaveOut(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){R.delete(t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=T.lastTouches,n=t.changedTouches[0];if(this.isPrimaryTouch(n)){var i={x:n.clientX,y:n.clientY};e.push(i);var s=function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}.bind(null,e,i);setTimeout(s,2500)}}};I=new Installer(A.elementAdded,A.elementRemoved,A.elementChanged,A);var L,N,z,G=a.pointermap,V=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Y={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){a.listen(t,this.events)},unregister:function(t){a.unlisten(t,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var e=t;return V&&((e=a.cloneEvent(t)).pointerType=this.POINTER_TYPES[t.pointerType]),e},cleanup:function(t){G.delete(t)},MSPointerDown:function(t){G.set(t.pointerId,t);var e=this.prepareEvent(t);a.down(e)},MSPointerMove:function(t){var e=this.prepareEvent(t);a.move(e)},MSPointerUp:function(t){var e=this.prepareEvent(t);a.up(e),this.cleanup(t.pointerId)},MSPointerOut:function(t){var e=this.prepareEvent(t);a.leaveOut(e)},MSPointerOver:function(t){var e=this.prepareEvent(t);a.enterOver(e)},MSPointerCancel:function(t){var e=this.prepareEvent(t);a.cancel(e),this.cleanup(t.pointerId)},MSLostPointerCapture:function(t){var e=a.makeEvent("lostpointercapture",t);a.dispatchEvent(e)},MSGotPointerCapture:function(t){var e=a.makeEvent("gotpointercapture",t);a.dispatchEvent(e)}};function assertActive(t){if(!a.pointermap.has(t)){var e=new Error("NotFoundError");throw e.name="NotFoundError",e}}function assertConnected(t){for(var e=t.parentNode;e&&e!==t.ownerDocument;)e=e.parentNode;if(!e){var n=new Error("InvalidStateError");throw n.name="InvalidStateError",n}}function inActiveButtonState(t){return 0!==a.pointermap.get(t).buttons}return window.navigator.msPointerEnabled?(L=function(t){assertActive(t),assertConnected(this),inActiveButtonState(t)&&(a.setCapture(t,this,!0),this.msSetPointerCapture(t))},N=function(t){assertActive(t),a.releaseCapture(t,!0),this.msReleasePointerCapture(t)}):(L=function setPointerCapture(t){assertActive(t),assertConnected(this),inActiveButtonState(t)&&a.setCapture(t,this)},N=function releasePointerCapture(t){assertActive(t),a.releaseCapture(t)}),z=function hasPointerCapture(t){return!!a.captureInfo[t]},function applyAttributeStyles(){if(x){b.forEach((function(t){w+=t.selector+rule(t.value)+"\n",P&&(w+=function shadowSelector(t){return"body /shadow-deep/ "+t}(t.selector)+rule(t.value)+"\n")}));var t=document.createElement("style");t.textContent=w,document.head.appendChild(t)}}(),function applyPolyfill(){if(!window.PointerEvent){if(window.PointerEvent=PointerEvent,window.navigator.msPointerEnabled){var t=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:t,enumerable:!0}),a.registerSource("ms",Y)}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),a.registerSource("mouse",T),void 0!==window.ontouchstart&&a.registerSource("touch",A);a.register(document)}}(),function applyPolyfill$1(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:L},releasePointerCapture:{value:N},hasPointerCapture:{value:z}})}(),{dispatcher:a,Installer:Installer,PointerEvent:PointerEvent,PointerMap:n,targetFinding:l}}()}));
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */const directive=t=>(...e)=>{const n=t(...e);return n.isDirective=!0,n};class Directive{constructor(){this.isDirective=!0,this.isClass=!0}body(t){}}const isDirective=t=>null!=t&&"boolean"==typeof t.isDirective,e="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,reparentNodes=(t,e,n=null,i=null)=>{for(;e!==n;){const n=e.nextSibling;t.insertBefore(e,i),e=n}},removeNodes=(t,e,n=null)=>{for(;e!==n;){const n=e.nextSibling;t.removeChild(e),e=n}},n={},i={},s=`{{lit-${String(Math.random()).slice(2)}}}`,o=`\x3c!--${s}--\x3e`,r=new RegExp(`${s}|${o}`);
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */class Template{constructor(t,e){this.parts=[],this.element=e;const n=[],i=[],o=document.createTreeWalker(e.content,133,null,!1);let a=0,h=-1,u=0;const{strings:m,values:{length:p}}=t;for(;u<p;){const t=o.nextNode();if(null!==t){if(h++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:n}=e;let i=0;for(let t=0;t<n;t++)endsWith(e[t].name,"$lit$")&&i++;for(;i-- >0;){const e=m[u],n=l.exec(e)[2],i=n.toLowerCase()+"$lit$",s=t.getAttribute(i);t.removeAttribute(i);const o=s.split(r);this.parts.push({type:"attribute",index:h,name:n,strings:o}),u+=o.length-1}}"TEMPLATE"===t.tagName&&(i.push(t),o.currentNode=t.content)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(s)>=0){const i=t.parentNode,s=e.split(r),o=s.length-1;for(let e=0;e<o;e++){let n,o=s[e];if(""===o)n=createMarker();else{const t=l.exec(o);null!==t&&endsWith(t[2],"$lit$")&&(o=o.slice(0,t.index)+t[1]+t[2].slice(0,-"$lit$".length)+t[3]),n=document.createTextNode(o)}i.insertBefore(n,t),this.parts.push({type:"node",index:++h})}""===s[o]?(i.insertBefore(createMarker(),t),n.push(t)):t.data=s[o],u+=o}}else if(8===t.nodeType)if(t.data===s){const e=t.parentNode;null!==t.previousSibling&&h!==a||(h++,e.insertBefore(createMarker(),t)),a=h,this.parts.push({type:"node",index:h}),null===t.nextSibling?t.data="":(n.push(t),h--),u++}else{let e=-1;for(;-1!==(e=t.data.indexOf(s,e+1));)this.parts.push({type:"node",index:-1}),u++}}else o.currentNode=i.pop()}for(const t of n)t.parentNode.removeChild(t)}}const endsWith=(t,e)=>{const n=t.length-e.length;return n>=0&&t.slice(n)===e},isTemplatePartActive=t=>-1!==t.index,a=document.createComment(""),createMarker=()=>a.cloneNode(),l=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */
class TemplateInstance{constructor(t,e,n){this.__parts=[],this.template=t,this.processor=e,this.options=n}update(t){let e=0;for(const n of this.__parts)void 0!==n&&n.setValue(t[e]),e++;for(const t of this.__parts)void 0!==t&&t.commit()}_clone(){const t=e?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],i=this.template.parts,s=document.createTreeWalker(t,133,null,!1);let o,r=0,a=0,l=s.nextNode();for(;r<i.length;)if(o=i[r],isTemplatePartActive(o)){for(;a<o.index;)a++,"TEMPLATE"===l.nodeName&&(n.push(l),s.currentNode=l.content),null===(l=s.nextNode())&&(s.currentNode=n.pop(),l=s.nextNode());if("node"===o.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(l.previousSibling),this.__parts.push(t)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,o.name,o.strings,this.options));r++}else this.__parts.push(void 0),r++;return e&&(document.adoptNode(t),customElements.upgrade(t)),t}}
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */const h=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:t=>t}),u=` ${s} `,m=document.createElement("template");class TemplateResult{constructor(t,e,n,i){this.strings=t,this.values=e,this.type=n,this.processor=i}getHTML(){const t=this.strings.length-1;let e="",n=!1;for(let i=0;i<t;i++){const t=this.strings[i],r=t.lastIndexOf("\x3c!--");n=(r>-1||n)&&-1===t.indexOf("--\x3e",r+1);const a=l.exec(t);e+=null===a?t+(n?u:o):t.substr(0,a.index)+a[1]+a[2]+"$lit$"+a[3]+s}return e+=this.strings[t],e}getTemplateElement(){const t=m.cloneNode();let e=this.getHTML();return void 0!==h&&(e=h.createHTML(e)),t.innerHTML=e,t}}class SVGTemplateResult extends TemplateResult{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),e=t.content,n=e.firstChild;return e.removeChild(n),reparentNodes(e,n.firstChild),t}}
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */const isPrimitive=t=>null===t||!("object"==typeof t||"function"==typeof t),isIterable=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]),p=document.createTextNode("");class AttributeCommitter{constructor(t,e,n){this.dirty=!0,this.element=t,this.name=e,this.strings=n,this.parts=[];for(let t=0;t<n.length-1;t++)this.parts[t]=this._createPart()}_createPart(){return new AttributePart(this)}_getValue(){const t=this.strings,e=t.length-1,n=this.parts;if(1===e&&""===t[0]&&""===t[1]){const t=n[0].value;if("symbol"==typeof t)return String(t);if("string"==typeof t||!isIterable(t))return t}let i="";for(let s=0;s<e;s++){i+=t[s];const e=n[s];if(void 0!==e){const t=e.value;if(isPrimitive(t)||!isIterable(t))i+="string"==typeof t?t:String(t);else for(const e of t)i+="string"==typeof e?e:String(e)}}return i+=t[e],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class AttributePart{constructor(t){this.value=void 0,this.committer=t}setValue(t){t===n||isPrimitive(t)&&t===this.value||(this.value=t,isDirective(t)||(this.committer.dirty=!0))}commit(){for(;isDirective(this.value);){const t=this.value;this.value=n,t.isClass?t.body(this):t(this)}this.value!==n&&this.committer.commit()}}class NodePart{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(createMarker()),this.endNode=t.appendChild(createMarker())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=createMarker()),t.__insert(this.endNode=createMarker())}insertAfterPart(t){t.__insert(this.startNode=createMarker()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(null===this.startNode.parentNode)return;for(;isDirective(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=n,t.isClass?t.body(this):t(this)}const t=this.__pendingValue;t!==n&&(isPrimitive(t)?t!==this.value&&this.__commitText(t):t instanceof TemplateResult?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):isIterable(t)?this.__commitIterable(t):t===i?(this.value=i,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,n="string"==typeof(t=null==t?"":t)?t:String(t);if(e===this.endNode.previousSibling&&3===e.nodeType)e.data=n;else{const t=p.cloneNode();t.textContent=n,this.__commitNode(t)}this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof TemplateInstance&&this.value.template===e)this.value.update(t.values);else{const n=new TemplateInstance(e,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let n,i=0;for(const s of t)n=e[i],void 0===n&&(n=new NodePart(this.options),e.push(n),0===i?n.appendIntoPart(this):n.insertAfterPart(e[i-1])),n.setValue(s),n.commit(),i++;i<e.length&&(e.length=i,this.clear(n&&n.endNode))}clear(t=this.startNode){removeNodes(this.startNode.parentNode,t.nextSibling,this.endNode)}}class BooleanAttributePart{constructor(t,e,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;isDirective(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=n,t.isClass?t.body(this):t(this)}if(this.__pendingValue===n)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=n}}class PropertyCommitter extends AttributeCommitter{constructor(t,e,n){super(t,e,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new PropertyPart(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class PropertyPart extends AttributePart{}let f=!1;(()=>{try{const t={get capture(){return f=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})();class EventPart{constructor(t,e,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=n,this.__boundHandleEvent=t=>this.handleEvent(t)}setValue(t){this.__pendingValue=t}commit(){for(;isDirective(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=n,t.isClass?t.body(this):t(this)}if(this.__pendingValue===n)return;const t=this.__pendingValue,e=this.value,i=null==t||null!=e&&(t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive),s=null!=t&&(null==e||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),s&&(this.__options=getOptions(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=n}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const getOptions=t=>t&&(f?{capture:t.capture,passive:t.passive,once:t.once}:t.capture)
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */;class DefaultTemplateProcessor{handleAttributeExpressions(t,e,n,i){const s=e[0];if("."===s){return new PropertyCommitter(t,e.slice(1),n).parts}return"@"===s?[new EventPart(t,e.slice(1),i.eventContext)]:"?"===s?[new BooleanAttributePart(t,e.slice(1),n)]:new AttributeCommitter(t,e,n).parts}handleTextExpression(t){return new NodePart(t)}}const v=new DefaultTemplateProcessor;
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */function templateFactory(t){let e=b.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},b.set(t.type,e));let n=e.stringsArray.get(t.strings);if(void 0!==n)return n;const i=t.strings.join(s);return n=e.keyString.get(i),void 0===n&&(n=new Template(t,t.getTemplateElement()),e.keyString.set(i,n)),e.stringsArray.set(t.strings,n),n}const b=new Map,w=new WeakMap,render=(t,e,n)=>{let i=w.get(e);void 0===i&&(removeNodes(e,e.firstChild),w.set(e,i=new NodePart(Object.assign({templateFactory:templateFactory},n))),i.appendInto(e)),i.setValue(t),i.commit()};
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */
"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const html=(t,...e)=>new TemplateResult(t,e,"html",v),svg=(t,...e)=>new SVGTemplateResult(t,e,"svg",v);var x=Object.freeze({__proto__:null,html:html,svg:svg,DefaultTemplateProcessor:DefaultTemplateProcessor,defaultTemplateProcessor:v,directive:directive,Directive:Directive,isDirective:isDirective,removeNodes:removeNodes,reparentNodes:reparentNodes,noChange:n,nothing:i,AttributeCommitter:AttributeCommitter,AttributePart:AttributePart,BooleanAttributePart:BooleanAttributePart,EventPart:EventPart,isIterable:isIterable,isPrimitive:isPrimitive,NodePart:NodePart,PropertyCommitter:PropertyCommitter,PropertyPart:PropertyPart,parts:w,render:render,templateCaches:b,templateFactory:templateFactory,TemplateInstance:TemplateInstance,SVGTemplateResult:SVGTemplateResult,TemplateResult:TemplateResult,createMarker:createMarker,isTemplatePartActive:isTemplatePartActive,Template:Template}),__asyncValues=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},verb("next"),verb("throw"),verb("return"),e[Symbol.asyncIterator]=function(){return this},e);function verb(n){e[n]=t[n]&&function(e){return new Promise((function(i,s){(function settle(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,s,(e=t[n](e)).done,e.value)}))}}};
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */const P=directive((t,e)=>async n=>{var i,s;if(!(n instanceof NodePart))throw new Error("asyncAppend can only be used in text bindings");if(t===n.value)return;let o;n.value=t;let r=0;try{for(var a,l=__asyncValues(t);!(a=await l.next()).done;){let i=a.value;if(n.value!==t)break;0===r&&n.clear(),void 0!==e&&(i=e(i,r));let s=n.startNode;void 0!==o&&(s=createMarker(),o.endNode=s,n.endNode.parentNode.insertBefore(s,n.endNode)),o=new NodePart(n.options),o.insertAfterNode(s),o.setValue(i),o.commit(),r++}}catch(t){i={error:t}}finally{try{a&&!a.done&&(s=l.return)&&await s.call(l)}finally{if(i)throw i.error}}});
/**
	 * @license
	 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */var __asyncValues$1=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},verb("next"),verb("throw"),verb("return"),e[Symbol.asyncIterator]=function(){return this},e);function verb(n){e[n]=t[n]&&function(e){return new Promise((function(i,s){(function settle(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,s,(e=t[n](e)).done,e.value)}))}}};const C=directive((t,e)=>async n=>{var i,s;if(!(n instanceof NodePart))throw new Error("asyncReplace can only be used in text bindings");if(t===n.value)return;const o=new NodePart(n.options);n.value=t;let r=0;try{for(var a,l=__asyncValues$1(t);!(a=await l.next()).done;){let i=a.value;if(n.value!==t)break;0===r&&(n.clear(),o.appendIntoPart(n)),void 0!==e&&(i=e(i,r)),o.setValue(i),o.commit(),r++}}catch(t){i={error:t}}finally{try{a&&!a.done&&(s=l.return)&&await s.call(l)}finally{if(i)throw i.error}}}),D=new WeakMap,S=directive(t=>e=>{if(!(e instanceof NodePart))throw new Error("cache can only be used in text bindings");let n=D.get(e);void 0===n&&(n=new WeakMap,D.set(e,n));const i=e.value;if(i instanceof TemplateInstance){if(t instanceof TemplateResult&&i.template===e.options.templateFactory(t))return void e.setValue(t);{let t=n.get(i.template);void 0===t&&(t={instance:i,nodes:document.createDocumentFragment()},n.set(i.template,t)),reparentNodes(t.nodes,e.startNode.nextSibling,e.endNode)}}if(t instanceof TemplateResult){const i=e.options.templateFactory(t),s=n.get(i);void 0!==s&&(e.setValue(s.nodes),e.commit(),e.value=s.instance)}e.setValue(t)});
/**
	 * @license
	 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */
/**
	 * @license
	 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
	 * This code may only be used under the BSD style license found at
	 * http://polymer.github.io/LICENSE.txt
	 * The complete set of authors may be found at
	 * http://polymer.github.io/AUTHORS.txt
	 * The complete set of contributors may be found at
	 * http://polymer.github.io/CONTRIBUTORS.txt
	 * Code distributed by Google as part of the polymer project is also
	 * subject to an additional IP rights grant found at
	 * http://polymer.github.io/PATENTS.txt
	 */
class ClassList{constructor(t){this.classes=new Set,this.changed=!1,this.element=t;const e=(t.getAttribute("class")||"").split(/\s+/);for(const t of e)this.classes.add(t)}add(t){this.classes.add(t),this.changed=!0}remove(t){this.classes.delete(t),this.changed=!0}commit(){if(this.changed){let t="";this.classes.forEach(e=>t+=e+" "),this.element.setAttribute("class",t)}}}const I=new WeakMap,T=directive(t=>e=>{if(!(e instanceof AttributePart)||e instanceof PropertyPart||"class"!==e.committer.name||e.committer.parts.length>1)throw new Error("The `classMap` directive must be used in the `class` attribute and must be the only part in the attribute.");const{committer:n}=e,{element:i}=n;let s=I.get(e);void 0===s&&(i.setAttribute("class",n.strings.join(" ")),I.set(e,s=new Set));const o=i.classList||new ClassList(i);s.forEach(e=>{e in t||(o.remove(e),s.delete(e))});for(const e in t){const n=t[e];n!=s.has(e)&&(n?(o.add(e),s.add(e)):(o.remove(e),s.delete(e)))}"function"==typeof o.commit&&o.commit()}),O=new WeakMap,_=directive((t,e)=>n=>{const i=O.get(n);if(Array.isArray(t)){if(Array.isArray(i)&&i.length===t.length&&t.every((t,e)=>t===i[e]))return}else if(i===t&&(void 0!==t||O.has(n)))return;n.setValue(e()),O.set(n,Array.isArray(t)?Array.from(t):t)}),E=new WeakMap,R=directive(t=>e=>{const n=E.get(e);if(void 0===t&&e instanceof AttributePart){if(void 0!==n||!E.has(e)){const t=e.committer.name;e.committer.element.removeAttribute(t)}}else t!==n&&e.setValue(t);E.set(e,t)}),createAndInsertPart=(t,e)=>{const n=t.startNode.parentNode,i=void 0===e?t.endNode:e.startNode,s=n.insertBefore(createMarker(),i);n.insertBefore(createMarker(),i);const o=new NodePart(t.options);return o.insertAfterNode(s),o},updatePart=(t,e)=>(t.setValue(e),t.commit(),t),insertPartBefore=(t,e,n)=>{const i=t.startNode.parentNode,s=n?n.startNode:t.endNode,o=e.endNode.nextSibling;o!==s&&reparentNodes(i,e.startNode,o,s)},removePart=t=>{removeNodes(t.startNode.parentNode,t.startNode,t.endNode.nextSibling)},generateMap=(t,e,n)=>{const i=new Map;for(let s=e;s<=n;s++)i.set(t[s],s);return i},A=new WeakMap,L=new WeakMap,N=directive((t,e,n)=>{let i;return void 0===n?n=e:void 0!==e&&(i=e),e=>{if(!(e instanceof NodePart))throw new Error("repeat can only be used in text bindings");const s=A.get(e)||[],o=L.get(e)||[],r=[],a=[],l=[];let h,u,m=0;for(const e of t)l[m]=i?i(e,m):m,a[m]=n(e,m),m++;let p=0,f=s.length-1,v=0,b=a.length-1;for(;p<=f&&v<=b;)if(null===s[p])p++;else if(null===s[f])f--;else if(o[p]===l[v])r[v]=updatePart(s[p],a[v]),p++,v++;else if(o[f]===l[b])r[b]=updatePart(s[f],a[b]),f--,b--;else if(o[p]===l[b])r[b]=updatePart(s[p],a[b]),insertPartBefore(e,s[p],r[b+1]),p++,b--;else if(o[f]===l[v])r[v]=updatePart(s[f],a[v]),insertPartBefore(e,s[f],s[p]),f--,v++;else if(void 0===h&&(h=generateMap(l,v,b),u=generateMap(o,p,f)),h.has(o[p]))if(h.has(o[f])){const t=u.get(l[v]),n=void 0!==t?s[t]:null;if(null===n){const t=createAndInsertPart(e,s[p]);updatePart(t,a[v]),r[v]=t}else r[v]=updatePart(n,a[v]),insertPartBefore(e,n,s[p]),s[t]=null;v++}else removePart(s[f]),f--;else removePart(s[p]),p++;for(;v<=b;){const t=createAndInsertPart(e,r[b+1]);updatePart(t,a[v]),r[v++]=t}for(;p<=f;){const t=s[p++];null!==t&&removePart(t)}A.set(e,r),L.set(e,l)}}),z=new WeakMap,G=document.createElement("template"),V=directive(t=>e=>{if(!(e instanceof NodePart))throw new Error("unsafeHTML can only be used in text bindings");const n=z.get(e);if(void 0!==n&&isPrimitive(t)&&t===n.value&&e.value===n.fragment)return;const i=G.cloneNode();i.innerHTML=t;const s=document.importNode(i.content,!0);e.setValue(s),z.set(e,{value:t,fragment:s})}),Y=new WeakMap,H=directive((...t)=>e=>{let n=Y.get(e);void 0===n&&(n={lastRenderedIndex:2147483647,values:[]},Y.set(e,n));const i=n.values;let s=i.length;n.values=t;for(let o=0;o<t.length&&!(o>n.lastRenderedIndex);o++){const r=t[o];if(isPrimitive(r)||"function"!=typeof r.then){e.setValue(r),n.lastRenderedIndex=o;break}o<s&&r===i[o]||(n.lastRenderedIndex=2147483647,s=0,Promise.resolve(r).then(t=>{const i=n.values.indexOf(r);i>-1&&i<n.lastRenderedIndex&&(n.lastRenderedIndex=i,e.setValue(t),e.commit())}))}}),k=directive(t=>e=>{let n;if(e instanceof EventPart||e instanceof NodePart)throw new Error("The `live` directive is not allowed on text or event bindings");if(e instanceof BooleanAttributePart)checkStrings(e.strings),n=e.element.hasAttribute(e.name),e.value=n;else{const{element:i,name:s,strings:o}=e.committer;if(checkStrings(o),e instanceof PropertyPart){if(n=i[s],n===t)return}else e instanceof AttributePart&&(n=i.getAttribute(s));if(n===String(t))return}e.setValue(t)}),checkStrings=t=>{if(2!==t.length||""!==t[0]||""!==t[1])throw new Error("`live` bindings can only contain a single expression")},j=new WeakMap;class Detach extends Directive{constructor(t){super(),this.ifFn=t}body(t){const e=this.ifFn(),n=t.committer.element;if(e)j.has(t)||j.set(t,{element:n,nextSibling:n.nextSibling,previousSibling:n.previousSibling,parent:n.parentNode}),n.remove();else{const e=j.get(t);e&&(e.nextSibling&&e.nextSibling.parentNode?e.nextSibling.parentNode.insertBefore(e.element,e.nextSibling):e.previousSibling&&e.previousSibling.parentNode?e.previousSibling.parentNode.appendChild(e.element):e.parent&&e.parent.appendChild(e.element),j.delete(t))}}}class StyleMap extends Directive{constructor(t,e=!1){super(),this.toRemove=[],this.toUpdate=[],this.debug=!1,this.previous={},this.style=t,this.detach=e}setStyle(t){this.style=t}setDebug(t=!0){this.debug=t}setDetach(t){this.detach=t}body(t){this.toRemove.length=0,this.toUpdate.length=0;const e=t.committer.element,n=e.style;let i=this.previous;if(e.attributes.getNamedItem("style")){const t=e.attributes.getNamedItem("style").value.split(";").map(t=>t.substr(0,t.indexOf(":")).trim()).filter(t=>!!t);for(const e of t)void 0===this.style[e]&&(this.toRemove.includes(e)||this.toRemove.push(e))}for(const t in i)this.style.hasOwnProperty(t)&&void 0===this.style[t]&&(this.toRemove.includes(t)||this.toRemove.push(t));for(const t in this.style){if(!this.style.hasOwnProperty(t))continue;const e=this.style[t],n=i[t];void 0!==n&&n===e||this.toUpdate.push(t)}if(this.debug&&(console.log("[StyleMap] to remove",[...this.toRemove]),console.log("[StyleMap] to update",[...this.toUpdate])),this.toRemove.length||this.toUpdate.length){let t,i;this.detach&&(t=e.parentNode,t&&(i=e.nextSibling,e.remove()));for(const t of this.toRemove)n.removeProperty(t),n[t]&&delete n[t];for(const t of this.toUpdate){const e=this.style[t];t.includes("-")?n.setProperty(t,e):n[t]=e}this.detach&&t&&t.insertBefore(e,i),this.previous=Object.assign({},this.style)}}}class Action{constructor(){this.isAction=!0}}Action.prototype.isAction=!0;const W={element:document.createTextNode(""),axis:"xy",threshold:10,onDown(t){},onMove(t){},onUp(t){},onWheel(t){}},F="undefined"!=typeof PointerEvent;let X=0;class PointerAction extends Action{constructor(t,e){super(),this.moving="",this.initialX=0,this.initialY=0,this.lastY=0,this.lastX=0,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onWheel=this.onWheel.bind(this),this.element=t,this.id=++X,this.options=Object.assign(Object.assign({},W),e.pointerOptions),F?(t.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)):(t.addEventListener("touchstart",this.onPointerDown),document.addEventListener("touchmove",this.onPointerMove,{passive:!1}),document.addEventListener("touchend",this.onPointerUp),document.addEventListener("touchcancel",this.onPointerUp),t.addEventListener("mousedown",this.onPointerDown),document.addEventListener("mousemove",this.onPointerMove,{passive:!1}),document.addEventListener("mouseup",this.onPointerUp))}normalizeMouseWheelEvent(t){let e=t.deltaX||0,n=t.deltaY||0,i=t.deltaZ||0;const s=t.deltaMode,o=parseInt(getComputedStyle(t.target).getPropertyValue("line-height"));let r=1;switch(s){case 1:r=o;break;case 2:r=window.height}return e*=r,n*=r,i*=r,{x:e,y:n,z:i,event:t}}onWheel(t){const e=this.normalizeMouseWheelEvent(t);this.options.onWheel(e)}normalizePointerEvent(t){let e={x:0,y:0,pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0,event:t};switch(t.type){case"wheel":const n=this.normalizeMouseWheelEvent(t);e.x=n.x,e.y=n.y,e.pageX=e.x,e.pageY=e.y,e.screenX=e.x,e.screenY=e.y,e.clientX=e.x,e.clientY=e.y;break;case"touchstart":case"touchmove":case"touchend":case"touchcancel":e.x=t.changedTouches[0].screenX,e.y=t.changedTouches[0].screenY,e.pageX=t.changedTouches[0].pageX,e.pageY=t.changedTouches[0].pageY,e.screenX=t.changedTouches[0].screenX,e.screenY=t.changedTouches[0].screenY,e.clientX=t.changedTouches[0].clientX,e.clientY=t.changedTouches[0].clientY;break;default:e.x=t.x,e.y=t.y,e.pageX=t.pageX,e.pageY=t.pageY,e.screenX=t.screenX,e.screenY=t.screenY,e.clientX=t.clientX,e.clientY=t.clientY}return e}onPointerDown(t){if("mousedown"===t.type&&0!==t.button)return;this.moving="xy";const e=this.normalizePointerEvent(t);this.lastX=e.x,this.lastY=e.y,this.initialX=e.x,this.initialY=e.y,this.options.onDown(e)}handleX(t){let e=t.x-this.lastX;return this.lastY=t.y,this.lastX=t.x,e}handleY(t){let e=t.y-this.lastY;return this.lastY=t.y,this.lastX=t.x,e}onPointerMove(t){if(""===this.moving||"mousemove"===t.type&&0!==t.button)return;const e=this.normalizePointerEvent(t);if("x|y"===this.options.axis){let n=0,i=0;("x"===this.moving||"xy"===this.moving&&Math.abs(e.x-this.initialX)>this.options.threshold)&&(this.moving="x",n=this.handleX(e)),("y"===this.moving||"xy"===this.moving&&Math.abs(e.y-this.initialY)>this.options.threshold)&&(this.moving="y",i=this.handleY(e)),this.options.onMove({movementX:n,movementY:i,x:e.x,y:e.y,initialX:this.initialX,initialY:this.initialY,lastX:this.lastX,lastY:this.lastY,event:t})}else if("xy"===this.options.axis){let n=0,i=0;Math.abs(e.x-this.initialX)>this.options.threshold&&(n=this.handleX(e)),Math.abs(e.y-this.initialY)>this.options.threshold&&(i=this.handleY(e)),this.options.onMove({movementX:n,movementY:i,x:e.x,y:e.y,initialX:this.initialX,initialY:this.initialY,lastX:this.lastX,lastY:this.lastY,event:t})}else if("x"===this.options.axis)("x"===this.moving||"xy"===this.moving&&Math.abs(e.x-this.initialX)>this.options.threshold)&&(this.moving="x",this.options.onMove({movementX:this.handleX(e),movementY:0,initialX:this.initialX,initialY:this.initialY,lastX:this.lastX,lastY:this.lastY,event:t}));else if("y"===this.options.axis){let n=0;("y"===this.moving||"xy"===this.moving&&Math.abs(e.y-this.initialY)>this.options.threshold)&&(this.moving="y",n=this.handleY(e)),this.options.onMove({movementX:0,movementY:n,x:e.x,y:e.y,initialX:this.initialX,initialY:this.initialY,lastX:this.lastX,lastY:this.lastY,event:t})}}onPointerUp(t){this.moving="";const e=this.normalizePointerEvent(t);this.options.onUp({movementX:0,movementY:0,x:e.x,y:e.y,initialX:this.initialX,initialY:this.initialY,lastX:this.lastX,lastY:this.lastY,event:t}),this.lastY=0,this.lastX=0}destroy(t){F?(t.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp)):(t.removeEventListener("mousedown",this.onPointerDown),document.removeEventListener("mousemove",this.onPointerMove),document.removeEventListener("mouseup",this.onPointerUp),t.removeEventListener("touchstart",this.onPointerDown),document.removeEventListener("touchmove",this.onPointerMove),document.removeEventListener("touchend",this.onPointerUp),document.removeEventListener("touchcancel",this.onPointerUp))}}function schedule(t){let e=0;return function wrapperFn(n){e||(e=requestAnimationFrame((function executeFrame(){e=0,t.apply(void 0,[n])})))}}function isObject(t){return t&&"object"==typeof t&&t.constructor&&"Object"===t.constructor.name}function mergeDeep(t,...e){const n=e.shift();if(isObject(t)&&isObject(n))for(const e in n)if(isObject(n[e]))"function"==typeof n[e].clone?t[e]=n[e].clone():(void 0===t[e]&&(t[e]={}),t[e]=mergeDeep(t[e],n[e]));else if(Array.isArray(n[e])){t[e]=new Array(n[e].length);let i=0;for(let s of n[e])isObject(s)?"function"==typeof s.clone?t[e][i]=s.clone():t[e][i]=mergeDeep({},s):t[e][i]=s,i++}else t[e]=n[e];return e.length?mergeDeep(t,...e):t}function clone(t){if(void 0!==t.actions){const e=t.actions.map(t=>{const e=Object.assign({},t),n=Object.assign({},e.props);return delete n.state,delete n.api,delete e.element,e.props=n,e});t.actions=e}return mergeDeep({},t)}var B={mergeDeep:mergeDeep,clone:clone,schedule:schedule};class Slots{constructor(t,e){this.slotInstances={},this.destroyed=!1,this.vido=t,this.props=e,this.destroy=this.destroy.bind(this),this.change=this.change.bind(this),this.html=this.html.bind(this),this.getInstances=this.getInstances.bind(this),this.setComponents=this.setComponents.bind(this),this.vido.onDestroy(()=>{this.destroy()})}setComponents(t){if(t&&!this.destroyed){for(const e in t){const n=t[e];void 0===this.slotInstances[e]&&(this.slotInstances[e]=[]);for(const t of this.slotInstances[e])t.destroy();this.slotInstances[e].length=0;for(const t of n)this.slotInstances[e].push(this.vido.createComponent(t,this.props))}this.vido.update()}}destroy(){if(!this.destroyed){for(const t in this.slotInstances){for(const e of this.slotInstances[t])e.destroy();this.slotInstances[t].length=0}this.destroyed=!0}}change(t,e){if(!this.destroyed)for(const n in this.slotInstances){const i=this.slotInstances[n];for(const n of i)n.change(t,e)}}getInstances(t){if(!this.destroyed)return void 0===t?this.slotInstances:this.slotInstances[t]}html(t,e){if(this.destroyed)return;if(!this.slotInstances[t]||0===this.slotInstances[t].length)return e;let n=e;for(const e of this.slotInstances[t])n=e.html(n);return n}getProps(){return this.props}isDestroyed(){return this.destroyed}}function Vido(t,e){let n=0;const i=new Map;let s,o,r=new Map,a=0;const l=[],h=Promise.resolve(),u={},m=function getActionsCollector(t){return class ActionsCollector extends Directive{constructor(t){super(),this.instance=t}set(t,e){return this.actions=t,this.props=e,this}body(e){const n=e.committer.element;for(const e of this.actions)if(void 0!==e){let i;if(t.has(this.instance))for(const s of t.get(this.instance))if(s.componentAction.create===e&&s.element===n){i=s;break}if(i)i.props=this.props;else{void 0!==n.vido&&delete n.vido;const i={create:e,update(){},destroy(){}},s={instance:this.instance,componentAction:i,element:n,props:this.props};let o=[];t.has(this.instance)&&(o=t.get(this.instance)),o.push(s),t.set(this.instance,o)}}}}}(r);class InstanceActionsCollector{constructor(t){this.instance=t}create(t,e){const n=new m(this.instance);return n.set(t,e),n}}const p=function getPublicComponentMethods(t,e,n){return class PublicComponentMethods{constructor(t,e,n={}){this.destroyed=!1,this.instance=t,this.name=e.name,this.vidoInstance=e,this.props=n,this.destroy=this.destroy.bind(this),this.update=this.update.bind(this),this.change=this.change.bind(this),this.html=this.html.bind(this)}destroy(){this.destroyed||(this.vidoInstance.debug&&(console.groupCollapsed(`destroying component ${this.instance}`),console.log(n({components:t.keys(),actionsByInstance:e})),console.trace(),console.groupEnd()),this.vidoInstance.destroyComponent(this.instance,this.vidoInstance),this.destroyed=!0)}update(i){return this.vidoInstance.debug&&(console.groupCollapsed(`updating component ${this.instance}`),console.log(n({components:t.keys(),actionsByInstance:e})),console.trace(),console.groupEnd()),this.vidoInstance.updateTemplate(i)}change(i,s){this.vidoInstance.debug&&(console.groupCollapsed(`changing component ${this.instance}`),console.log(n({props:this.props,newProps:i,components:t.keys(),actionsByInstance:e})),console.trace(),console.groupEnd());const o=t.get(this.instance);o&&o.change(i,s)}html(e={}){const n=t.get(this.instance);if(n&&!n.destroyed)return n.update(e,this.vidoInstance)}_getComponents(){return t}_getActions(){return e}}}(i,r,clone),f=function getInternalComponentMethods(t,e,n){return class InternalComponentMethods{constructor(t,e,n,i){this.destroyed=!1,this.instance=t,this.vidoInstance=e,this.renderFunction=n,this.content=i,this.destroy=this.destroy.bind(this),this.update=this.update.bind(this),this.change=this.change.bind(this)}destroy(){if(!this.destroyed){this.vidoInstance.debug&&(console.groupCollapsed(`component destroy method fired ${this.instance}`),console.log(n({props:this.vidoInstance.props,components:t.keys(),destroyable:this.vidoInstance.destroyable,actionsByInstance:e})),console.trace(),console.groupEnd()),this.content&&"function"==typeof this.content.destroy&&this.content.destroy();for(const t of this.vidoInstance.destroyable)t();this.vidoInstance.onChangeFunctions.length=0,this.vidoInstance.destroyable.length=0,this.vidoInstance.destroyed=!0,this.destroyed=!0,this.vidoInstance.update()}}update(i={}){return this.vidoInstance.debug&&(console.groupCollapsed(`component update method fired ${this.instance}`),console.log(n({components:t.keys(),actionsByInstance:e})),console.trace(),console.groupEnd()),this.renderFunction(i)}change(i,s={leave:!1}){const o=i;this.vidoInstance.debug&&(console.groupCollapsed(`component change method fired ${this.instance}`),console.log(n({props:o,components:t.keys(),onChangeFunctions:this.vidoInstance.onChangeFunctions,changedProps:i,actionsByInstance:e})),console.trace(),console.groupEnd());for(const t of this.vidoInstance.onChangeFunctions)t(i,s)}}}(i,r,clone);class VidoInstance{constructor(){this.destroyable=[],this.destroyed=!1,this.onChangeFunctions=[],this.debug=!1,this.state=t,this.api=e,this.lastProps={},this.html=html,this.svg=svg,this.directive=directive,this.asyncAppend=P,this.asyncReplace=C,this.cache=S,this.classMap=T,this.guard=_,this.live=k,this.ifDefined=R,this.repeat=N,this.unsafeHTML=V,this.until=H,this.schedule=schedule,this.actionsByInstance=(t,e)=>{},this.StyleMap=StyleMap,this.Detach=Detach,this.PointerAction=PointerAction,this.Action=Action,this.Slots=Slots,this._components=i,this._actions=r,this.reuseComponents=this.reuseComponents.bind(this),this.onDestroy=this.onDestroy.bind(this),this.onChange=this.onChange.bind(this),this.update=this.update.bind(this),this.destroyComponent=this.destroyComponent.bind(this);for(const t in u)this[t]=u[t].bind(this)}static addMethod(t,e){u[t]=e}onDestroy(t){this.destroyable.push(t)}onChange(t){this.onChangeFunctions.push(t)}update(t){return this.updateTemplate(t)}reuseComponents(t,e,n,i,s=!0,o=!1){const r=[],a=t.length,l=e.length;let h=!1;!s||void 0!==e&&0!==e.length||(h=!0);let u=0;if(a<l){let s=l-a;for(;s;){const o=e[l-s],a=this.createComponent(i,n(o));t.push(a),r.push(a),s--}}else if(a>l){let e=a-l;for(s&&(h=!0,u=a-e);e;){const n=a-e;s||(r.push(t[n]),t[n].destroy()),e--}s||(t.length=l)}let m=0;o&&console.log("modified components",r),o&&console.log("current components",t),o&&console.log("data array",e);for(const i of t){const t=e[m];o&&console.log(`reuse components data at '${m}'`,t),i&&!r.includes(i)&&(o&&console.log("getProps fn result",n(t)),i.change(n(t),{leave:h&&m>=u})),m++}}createComponent(t,e={},s=null){const o=t.name+":"+n++;let a;a=new VidoInstance,a.instance=o,a.destroyed=!1,a.name=t.name,a.Actions=new InstanceActionsCollector(o);const l=new p(o,a,e),h=new f(o,a,t(a,e,s),s);return i.set(o,h),i.get(o).change(e),a.debug&&(console.groupCollapsed(`component created ${o}`),console.log(clone({props:e,components:i.keys(),actionsByInstance:r})),console.trace(),console.groupEnd()),l}destroyComponent(t,e){if(e.debug&&(console.groupCollapsed(`destroying component ${t}...`),console.log(clone({components:i.keys(),actionsByInstance:r})),console.trace(),console.groupEnd()),r.has(t))for(const e of r.get(t))"function"==typeof e.componentAction.destroy&&e.componentAction.destroy(e.element,e.props);r.delete(t);const n=i.get(t);n?(n.destroy(),i.delete(t),e.debug&&(console.groupCollapsed(`component destroyed ${t}`),console.log(clone({components:i.keys(),actionsByInstance:r})),console.trace(),console.groupEnd())):console.warn(`No component to destroy! [${t}]`)}executeActions(){for(const t of r.values()){for(const e of t)if(void 0===e.element.vido){const t=i.get(e.instance);e.isActive=function isActive(){return t&&!1===t.destroyed};const n=e.componentAction,s=n.create;if(void 0!==s){let t;t=s.prototype&&(s.prototype.isAction||s.prototype.update||s.prototype.destroy)||s.isAction?new s(e.element,e.props):s(e.element,e.props),void 0!==t&&("function"==typeof t?n.destroy=t:("function"==typeof t.update&&(n.update=t.update.bind(t)),"function"==typeof t.destroy&&(n.destroy=t.destroy.bind(t))))}}else e.element.vido=e.props,"function"==typeof e.componentAction.update&&e.isActive()&&e.componentAction.update(e.element,e.props);for(const e of t)e.element.vido=e.props}}updateTemplate(t){return t&&l.push(t),new Promise(t=>{const e=++a,n=this;h.then((function flush(){if(e===a){a=0,n.render();for(const t of l)t();l.length=0,t()}}))})}createApp(t){o=t.element;const e=this.createComponent(t.component,t.props);return s=e.instance,this.render(),e}render(){const t=i.get(s);t?(render(t.update(),o),this.executeActions()):o&&o.remove()}}return new VidoInstance}
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
function __awaiter(t,e,n,i){return new(n||(n=Promise))((function(s,o){function fulfilled(t){try{step(i.next(t))}catch(t){o(t)}}function rejected(t){try{step(i.throw(t))}catch(t){o(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((i=i.apply(t,e||[])).next())}))}Vido.prototype.lithtml=x,Vido.prototype.Action=Action,Vido.prototype.Directive=Directive,Vido.prototype.schedule=schedule,Vido.prototype.Detach=Detach,Vido.prototype.StyleMap=StyleMap,Vido.prototype.PointerAction=PointerAction,Vido.prototype.asyncAppend=P,Vido.prototype.asyncReplace=C,Vido.prototype.cache=S,Vido.prototype.classMap=T,Vido.prototype.guard=_,Vido.prototype.live=k,Vido.prototype.ifDefined=R,Vido.prototype.repeat=N,Vido.prototype.unsafeHTML=V,Vido.prototype.until=H,Vido.prototype.Slots=Slots;var U=function(){if("undefined"!=typeof Map)return Map;function getIndex(t,e){var n=-1;return t.some((function(t,i){return t[0]===e&&(n=i,!0)})),n}return function(){function class_1(){this.__entries__=[]}return Object.defineProperty(class_1.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),class_1.prototype.get=function(t){var e=getIndex(this.__entries__,t),n=this.__entries__[e];return n&&n[1]},class_1.prototype.set=function(t,e){var n=getIndex(this.__entries__,t);~n?this.__entries__[n][1]=e:this.__entries__.push([t,e])},class_1.prototype.delete=function(t){var e=this.__entries__,n=getIndex(e,t);~n&&e.splice(n,1)},class_1.prototype.has=function(t){return!!~getIndex(this.__entries__,t)},class_1.prototype.clear=function(){this.__entries__.splice(0)},class_1.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,i=this.__entries__;n<i.length;n++){var s=i[n];t.call(e,s[1],s[0])}},class_1}()}(),q="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,K="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),Q="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(K):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var J=["top","right","bottom","left","width","height","size","weight"],Z="undefined"!=typeof MutationObserver,tt=function(){function ResizeObserverController(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function throttle(t,e){var n=!1,i=!1,s=0;function resolvePending(){n&&(n=!1,t()),i&&proxy()}function timeoutCallback(){Q(resolvePending)}function proxy(){var t=Date.now();if(n){if(t-s<2)return;i=!0}else n=!0,i=!1,setTimeout(timeoutCallback,e);s=t}return proxy}(this.refresh.bind(this),20)}return ResizeObserverController.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},ResizeObserverController.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},ResizeObserverController.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},ResizeObserverController.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},ResizeObserverController.prototype.connect_=function(){q&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Z?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},ResizeObserverController.prototype.disconnect_=function(){q&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},ResizeObserverController.prototype.onTransitionEnd_=function(t){var e=t.propertyName,n=void 0===e?"":e;J.some((function(t){return!!~n.indexOf(t)}))&&this.refresh()},ResizeObserverController.getInstance=function(){return this.instance_||(this.instance_=new ResizeObserverController),this.instance_},ResizeObserverController.instance_=null,ResizeObserverController}(),defineConfigurable=function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n++){var s=i[n];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},getWindowOf=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||K},et=createRectInit(0,0,0,0);function toFloat(t){return parseFloat(t)||0}function getBordersSize(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduce((function(e,n){return e+toFloat(t["border-"+n+"-width"])}),0)}function getHTMLElementContentRect(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return et;var i=getWindowOf(t).getComputedStyle(t),s=function getPaddings(t){for(var e={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var s=i[n],o=t["padding-"+s];e[s]=toFloat(o)}return e}(i),o=s.left+s.right,r=s.top+s.bottom,a=toFloat(i.width),l=toFloat(i.height);if("border-box"===i.boxSizing&&(Math.round(a+o)!==e&&(a-=getBordersSize(i,"left","right")+o),Math.round(l+r)!==n&&(l-=getBordersSize(i,"top","bottom")+r)),!function isDocumentElement(t){return t===getWindowOf(t).document.documentElement}(t)){var h=Math.round(a+o)-e,u=Math.round(l+r)-n;1!==Math.abs(h)&&(a-=h),1!==Math.abs(u)&&(l-=u)}return createRectInit(s.left,s.top,a,l)}var nt="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof getWindowOf(t).SVGGraphicsElement}:function(t){return t instanceof getWindowOf(t).SVGElement&&"function"==typeof t.getBBox};function getContentRect(t){return q?nt(t)?function getSVGContentRect(t){var e=t.getBBox();return createRectInit(0,0,e.width,e.height)}(t):getHTMLElementContentRect(t):et}function createRectInit(t,e,n,i){return{x:t,y:e,width:n,height:i}}var it=function(){function ResizeObservation(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=createRectInit(0,0,0,0),this.target=t}return ResizeObservation.prototype.isActive=function(){var t=getContentRect(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},ResizeObservation.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},ResizeObservation}(),st=function st(t,e){var n=function createReadOnlyRect(t){var e=t.x,n=t.y,i=t.width,s=t.height,o="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,r=Object.create(o.prototype);return defineConfigurable(r,{x:e,y:n,width:i,height:s,top:n,right:e+i,bottom:s+n,left:e}),r}(e);defineConfigurable(this,{target:t,contentRect:n})},ot=function(){function ResizeObserverSPI(t,e,n){if(this.activeObservations_=[],this.observations_=new U,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return ResizeObserverSPI.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof getWindowOf(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new it(t)),this.controller_.addObserver(this),this.controller_.refresh())}},ResizeObserverSPI.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof getWindowOf(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},ResizeObserverSPI.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},ResizeObserverSPI.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},ResizeObserverSPI.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new st(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},ResizeObserverSPI.prototype.clearActive=function(){this.activeObservations_.splice(0)},ResizeObserverSPI.prototype.hasActive=function(){return this.activeObservations_.length>0},ResizeObserverSPI}(),rt="undefined"!=typeof WeakMap?new WeakMap:new U,at=function ResizeObserver(t){if(!(this instanceof ResizeObserver))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=tt.getInstance(),n=new ot(t,e,this);rt.set(this,n)};["observe","unobserve","disconnect"].forEach((function(t){at.prototype[t]=function(){var e;return(e=rt.get(this))[t].apply(e,arguments)}}));var lt=void 0!==K.ResizeObserver?K.ResizeObserver:at;function Main(t,e={}){const{api:n,state:i,onDestroy:s,Actions:o,update:r,createComponent:a,html:l,StyleMap:h}=t,u=n.name;let m;s(i.subscribe("config.debug",t=>m=t));const p=[];function destroyPlugins(){p.forEach(t=>t()),p.length=0}let f;s(i.subscribe("config.plugins",e=>{if(m&&console.log("Plugins changed. Destroying plugins..."),destroyPlugins(),m&&console.log("Plugins destroyed. Initializing plugins..."),void 0!==e&&Array.isArray(e))for(const n of e){const e=n(t);"function"==typeof e?p.push(e):e&&Object.prototype.hasOwnProperty.call(e,"destroy")&&p.push(e.destroy)}m&&console.log("Plugins intialized.")})),s(destroyPlugins),s(i.subscribe("config.actions.main",t=>f=t));const v=new h({});let b=!1,w=-1,x=!1;s(i.subscribe("config.useLast",t=>x=t));let P=n.getClass(u);function generateTree(t=!0){if(m&&console.log("Generating tree."),!t)return function generateTreeFromVisibleRows(){const t=n.getVisibleRowsId(),e=n.getAllRows(),s={},o=i.get("config.chart.items"),a={};for(const n of t){const t=e[n];s[n]=t;for(const n of t.$data.children){s[n]=e[n];for(const t of s[n].$data.items)a[t]=o[t]}for(const e of t.$data.items)a[e]=o[e]}n.makeTreeMap(s,a),r()}();const e=n.sortRows(Object.values(i.get("config.list.rows")));n.fillEmptyRowValues(e);const s=i.get("config.chart.items");n.prepareItems(s),n.makeTreeMap(e,s),r()}function calculateVerticalScrollArea(){const t=i.get("$data.list.rowsWithParentsExpanded"),e=i.get("$data.list.rowsHeight");if(e===w)return;w=e;const s=i.get("$data.innerHeight"),o=function getLastPageRowsHeight(t,e){if(0===e.length)return 0;let s=0,o=0;const r=n.getAllRows();for(let n=e.length-1;n>=0;n--){const i=r[e[n]];if(s+=i.$data.outerHeight,s>=t){s-=i.$data.outerHeight;break}o++}return m&&console.log("Last page height.",{lastPageCount:o,lastPageSize:s,rows:r}),i.multi().update("config.scroll.vertical.lastPageSize",s,{force:!0}).update("config.scroll.vertical.lastPageCount",o,{force:!0}).done(),s}(s,t);m&&console.log("Calculate height related things.",{rowsWithParentsExpanded:t,lastRowsHeight:w,innerHeight:s}),i.multi().update("config.scroll.vertical.area",e,{force:!0}).update("config.scroll.vertical.areaWithoutLastPage",e-o,{force:!0}).done()}function _minimalReload(){n.isMutedMethod("minimalReload")||(m&&console.log("Minimal reload fired.",{}),function generateVisibleRowsAndItems(){const t=n.getVisibleRows(i.get("$data.list.rowsWithParentsExpanded")),e=i.get("$data.list.visibleRows")||[];let s=!0;t.length!==e.length?s=!0:t.length&&(s=t.join("|")!==e.join("|")),m&&console.log("Generating visible rows and items #1.",{visibleRowsId:t,shouldUpdate:s}),s&&(m&&console.log("Saving visible rows and items #2.",{visibleRowsId:t,shouldUpdate:s}),i.update("$data.list.visibleRows",t));const o=[],a=n.getAllRows();for(const e of t){const t=a[e];for(const e of t.$data.items)o.push(e)}const l=i.get("$data.chart.visibleItems")||[];m&&console.log("Generating visible rows and items #3.",{visibleItemsId:o,visibleRowsId:t,shouldUpdate:s,rows:a}),o.join("|")!==l.join("|")&&(m&&console.log("Generate visible rows and items #4.",{visibleItemsId:o,currentVisibleItems:l}),i.update("$data.chart.visibleItems",o)),r()}(),function calculateRowsHeight(){if(n.isMutedMethod("calculateRowsHeight"))return;const t=i.get("$data.list.rowsWithParentsExpanded"),e=n.recalculateRowsHeights(t);i.update("$data.list.rowsHeight",e),m&&console.log("calculateRowsHeight.",{rowsHeight:e})}(),calculateVerticalScrollArea(),function recalculateRowPercents(){if(n.isMutedMethod("recalculateRowPercents"))return;const t=i.get("$data.list.rowsWithParentsExpanded");n.recalculateRowsPercents(t,i.get("config.scroll.vertical.area"))}(),function calculateVisibleRowsHeights(){const t=i.get("config.scroll.vertical.offset")||0,e=i.get("$data.list.visibleRows");let s=0;const o=n.getAllRows();for(const t of e)s+=n.recalculateRowHeight(o[t]);m&&console.log("Calculate visible rows height.",{height:s,rows:o,visibleRows:e}),i.update("$data.list.visibleRowsHeight",s+t)}(),updateVisibleItems().done(),r())}function partialReload(t=!0){n.isMutedMethod("partialReload")||(m&&console.log("Partial reload fired.",{fullReload:t}),generateTree(t),function prepareExpanded(){if(n.isMutedMethod("prepareExpanded"))return;const t=n.getAllRows();if(!t)return;const e=n.getRowsWithParentsExpanded(t);i.update("$data.list.rowsWithParentsExpanded",e)}(),_minimalReload(),r())}function triggerLoadedEvent(){Promise.resolve().then(()=>{const t=i.get("$data.elements.main");if(!t)return;const e=t.parentNode;if(!e)return;const n=new Event("gstc-loaded");t.dispatchEvent(n),e.dispatchEvent(n)})}function fullReload(){n.isMutedMethod("fullReload")||(m&&console.log("Full reload fired.",{}),partialReload(!0),recalculateTimes({name:"reload"}))}s(i.subscribeAll(["config.innerHeight","config.headerHeight","config.scroll.horizontal.size"],(function heightChange(){m&&console.log("Height change.",["config.innerHeight","config.headerHeight","config.scroll.horizontal.size"]);const t=i.get("config"),e=i.get("config.scroll.horizontal.size"),n=t.innerHeight-e;i.multi().update("$data.innerHeight",n).update("$data.height",t.innerHeight+t.headerHeight).done(),v.style["--height"]=n+"px",r()}))),s(i.subscribe("$data.list.columns.resizer.active",(function resizerActiveChange(t){b=t,P=n.getClass(n.name),b&&(P+=` ${n.name}__list-column-header-resizer--active`),r()}))),s(i.subscribeAll(["config.chart.items.*.time","config.chart.items.*.height","config.chart.items.*.top","config.list.rows.*.$data.outerHeight","config.scroll.vertical.offset","$data.innerHeight","$data.list.rowsHeight"],(t,e)=>{"subscribe"!==e.type&&function minimalReload(t=null,e=null){if(!(e&&"subscribe"===e.type||e&&e.options.data&&"updateVisibleItems"===e.options.data))return x?i.last(_minimalReload):void _minimalReload()}(t,e)},{bulk:!0})),s(i.subscribeAll(["config.list.rows.*.parentId","config.chart.items.*.rowId","config.list.rows.*.expanded"],(t,e)=>{"subscribe"!==e.type&&partialReload(!1)},{bulk:!0})),s(i.subscribeAll(["config.chart.items;","config.list.rows;"],(t,e)=>{"subscribe"!==e.type&&fullReload()}));const C=[];let D,S;C.push(i.subscribe("config.components.List",t=>D=t)),C.push(i.subscribe("config.components.Chart",t=>S=t));const I=a(D);s(()=>{I&&I.destroy()});const T=a(S);function generatePeriodDates(e,i,s,o){const r=e.period,a=i.from,l=n.time.date(a).startOf(r),h=n.time.date(i.to).endOf(r),u=n.time.generatePeriodDates({leftDate:l,rightDate:h,level:s,levelIndex:o,period:r,time:i,callOnDate:!1,callOnLevelDates:!0}),m=n.getClass("chart-calendar-date");for(const n of u)n.formatted=e.format({timeStart:n.leftGlobalDate,timeEnd:n.rightGlobalDate,vido:t,className:m,props:{date:n}});return u}function calculateDatesPercents(t,e){const n=function getLastPageDatesWidth(t,e){if(0===e.length)return 0;let n=0,s=0;for(let i=e.length-1;i>=0;i--){const o=e[i];if(n+=o.width,n>=t){n-=o.width;break}s++}return i.update("config.scroll.horizontal",t=>(t.lastPageSize=n,t.lastPageCount=s,t)),n}(e,t);let s=0;for(const e of t)s+=e.width;const o=s-n;for(const e of t)e.leftPercent=e.leftPx/o,e.rightPercent=e.rightPx/o;return o}function generateAllDates(t,e,n){if(!t.zoom)return 0;t.allDates=new Array(e.length);const{format:s,levelIndex:o}=function getFormatAndLevelIndexForZoom(t,e=i.get("config.chart.calendar.levels")){let n=0,s=0;for(const i of e){for(const e of i.formats)if(e.main&&t<=e.zoomTo)return s=n,{levelIndex:s,format:e};n++}if(!s)throw new Error(`There is no main date format for zoom ${t}.`)}(t.zoom,e);t.level=o,t.allDates[t.level]=generatePeriodDates(s,t,e[o],t.level);let r=0;for(const n of e){const e=n.formats.find(e=>+t.zoom<=+e.zoomTo);r!==t.level&&(t.allDates[r]=generatePeriodDates(e,t,n,o)),r++}return calculateDatesPercents(t.allDates[t.level],n)}function getPeriodDates(t,e){if(!t.length)return[];const i=t.filter(t=>t.leftGlobal>=e.leftGlobal&&t.leftGlobal<=e.rightGlobal||t.rightGlobal>=e.leftGlobal&&t.rightGlobal<=e.rightGlobal||t.leftGlobal<=e.leftGlobal&&t.rightGlobal>=e.rightGlobal||t.leftGlobal>=e.leftGlobal&&t.rightGlobal<=e.rightGlobal);if(!i.length)return[];let s=0;i[0].period!==e.period&&e.leftGlobal>i[0].leftGlobal&&(s=n.time.getDatesDiffPx(e.leftGlobalDate,i[0].leftGlobalDate,e,!1));let o=0;const r=i.length-1;return i.map((t,n)=>(t.currentView={leftPx:o,rightPx:t.rightPx,width:t.width},s<0&&(t.currentView.width=t.width+s,t.currentView.leftPx=0,s=0),t.currentView.rightPx=t.currentView.leftPx+t.currentView.width,o+=t.currentView.width,n===r&&t.currentView.rightPx>e.width&&(t.currentView.rightPx=e.width,t.currentView.width=t.currentView.rightPx-t.currentView.leftPx),t))}function calculateTotalViewDuration(t){let e=0,n=0;for(const i of t.allDates[t.level])e+=i.width,n+=i.rightGlobal-i.leftGlobal;t.totalViewDurationPx=e,t.totalViewDurationMs=n}function calculateRightGlobal(t,e,i){const s=n.time.findDateAtTime(t,i);if(!s)return t;let o=i.indexOf(s),r=s.leftGlobal,a=0;for(let t=i.length;o<t;o++){const t=i[o];if(r=t.leftGlobal,a+=t.width,a>=e)break}return r}function updateVisibleItems(t=i.get("$data.chart.time"),e=i.multi()){m&&console.log("Updating visible items.",{});const s=i.get("$data.chart.visibleItems"),o=n.getItems(s);if(!o)return e;const r=n.getAllRows();if(!r)return e;if(!t.levels||!t.levels[t.level])return e;const a=i.get("config.chart.spacing")||0;for(const i of o){if(!i)return e;const s=r[i.rowId];if(!s||!s.$data)continue;const o=n.getItemData(i.id),l=o.time.startDate.valueOf()===i.time.start?o.time.startDate:n.time.date(i.time.start),h=o.time.endDate.valueOf()===i.time.end?o.time.endDate:n.time.date(i.time.end),u=n.time.getViewOffsetPxFromDates(l,!1,t),p=n.time.getViewOffsetPxFromDates(h,!1,t),f=o.position.top+i.gap.top,v=s.$data.position.viewTop+o.position.actualTop;e=e.update(`$data.chart.items.${i.id}`,(function(e){if(m&&console.log("Update visible item",{$data:e,item:i}),e)return e.position.left=u,e.position.actualLeft=n.time.limitOffsetPxToView(u,t),e.position.right=p,e.position.actualRight=n.time.limitOffsetPxToView(p,t),e.width=p-u-a,e.actualWidth=e.position.actualRight-e.position.actualLeft-a,e.position.actualTop=f,e.position.viewTop=v,e}),{data:"updateVisibleItems"})}return m&&console.log("Visible items updated.",{visibleItemsId:s,visibleItems:o}),e}function recalculateTimes(t){m&&console.log("Recalculating times.",{reason:t});const e=i.get("$data.chart.dimensions.width");if(!e)return;const s=i.get("config.chart.time"),o=i.get("config.chart.calendar"),a=Object.assign({},i.get("$data.chart.time"));let l=n.mergeDeep({},s);if(!(l.from&&l.to||Object.keys(i.get("config.chart.items")).length))return;l.fromDate=n.time.date(l.from),l.toDate=n.time.date(l.to);const h=i.get("config.scroll.horizontal");let u=0;if(l.calculatedZoomMode&&e){if(l.totalViewDurationMs=n.time.date(l.to).diff(l.from,"millisecond"),l.timePerPixel=l.totalViewDurationMs/e,l.zoom=Math.log(l.timePerPixel)/Math.log(2),function guessPeriod(t,e){if(!t.zoom)return t;for(const n of e){const e=n.formats.find(e=>+t.zoom<=+e.zoomTo);e&&e.main&&(t.period=e.period)}return m&&console.log("[main.ts] guessPeriod",t.period,{time:t}),t}(l,o.levels),a.zoom!==l.zoom||0===l.allDates.length||"forceUpdate"===t.name||"items"===t.name||"reload"===t.name||"from"===t.name||"to"===t.name){u=generateAllDates(l,o.levels,e),calculateTotalViewDuration(l);const t=l.allDates[l.level];l.to=t[t.length-1].rightGlobal,l.toDate=n.time.date(l.to)}l.leftGlobal=l.from,l.leftGlobalDate=n.time.date(l.leftGlobal),l.rightGlobal=l.to,l.rightGlobalDate=n.time.date(l.rightGlobal)}else if(l.timePerPixel=Math.pow(2,l.zoom),"items"===t.name&&(l.from=t.from,l.to=t.to,l.fromDate=n.time.date(l.from),l.toDate=n.time.date(l.to)),l=n.time.recalculateFromTo(l),a.zoom!==l.zoom||0===l.allDates.length||"forceUpdate"===t.name||"items"===t.name||"reload"===t.name||"from"===t.name||"to"===t.name){u=generateAllDates(l,o.levels,e),calculateTotalViewDuration(l);const t=l.allDates[l.level];l.to=t[t.length-1].rightGlobal,l.toDate=n.time.date(l.to)}else l.totalViewDurationPx=a.totalViewDurationPx,l.totalViewDurationMs=a.totalViewDurationMs;l.scrollWidth=u||a.scrollWidth;const p=l.allDates[l.level];let f=!1;const v=i.get("$data.chart.time.recalculateTimesLastReason")||"";if(!l.calculatedZoomMode)if(l.zoom===a.zoom&&"period"!==t.name||!a.centerGlobal){let t=h.data;t||(t=p[0]),l.leftGlobalDate=t.leftGlobalDate,l.leftGlobal=l.leftGlobalDate.valueOf(),l.rightGlobal=calculateRightGlobal(l.leftGlobal,e,p),l.rightGlobalDate=n.time.date(l.rightGlobal).endOf(l.period),l.rightGlobal=l.rightGlobal.valueOf(),f="zoom"!==v&&"period"!==v&&"time"!==v}else{const t=e*l.timePerPixel,i=Math.round(t/2),s=Math.ceil(a.centerGlobalDate.diff(a.centerGlobal+i,l.period,!0));l.leftGlobalDate=a.centerGlobalDate.add(s,l.period);const o=l.leftGlobalDate.valueOf();let r=n.time.findDateAtTime(o,p);r||(r=p[0]),l.leftGlobal=r.leftGlobal,l.leftGlobalDate=r.leftGlobalDate,l.rightGlobal=calculateRightGlobal(l.leftGlobal,e,p),l.rightGlobalDate=n.time.date(l.rightGlobal).endOf(l.period),l.rightGlobal=l.rightGlobalDate.valueOf()}!function limitGlobal(t,e){return t.leftGlobal<t.from&&(t.leftGlobal=t.from),t.rightGlobal>t.to&&(t.rightGlobal=t.to),t.leftGlobalDate=n.time.date(t.leftGlobal).startOf(t.period),t.leftGlobal=t.leftGlobalDate.valueOf(),t.rightGlobalDate=n.time.date(t.rightGlobal).endOf(t.period),t.rightGlobal=t.rightGlobalDate.valueOf(),t.centerGlobal=e.centerGlobal,t.centerGlobalDate=e.centerGlobalDate,t}(l,a),l.leftInner=l.leftGlobal-l.from,l.rightInner=l.rightGlobal-l.from,l.leftPx=0,l.rightPx=e,l.width=e,function updateLevels(t,e){t.levels=[];let n=0;for(const i of e){const e=i.formats.find(e=>+t.zoom<=+e.zoomTo);if(e.main&&(t.format=e,t.level=n),e){let s=getPeriodDates(t.allDates[n],t);t.onCurrentViewLevelDates.forEach(o=>{s=o({dates:s,format:e,time:t,level:i,levelIndex:n})}),t.levels.push(s)}n++}}(l,o.levels),f&&function setCenter(t){let e=Math.floor(t.rightGlobalDate.diff(t.leftGlobalDate,"millisecond",!0)/2);const i=n.time.getRightViewDate(t);i.width!==i.currentView.width&&(e-=(i.width-i.currentView.width)*t.timePerPixel),t.centerGlobalDate=t.leftGlobalDate.add(e,"millisecond"),t.centerGlobal=t.centerGlobalDate.valueOf()}(l);const b=l.levels[l.level];b&&b.length&&(l.leftPx=b[0].leftPx,l.rightPx=b[b.length-1].leftPx);let w=i.multi().update("$data.chart.time",l).update("config.chart.time",t=>(t.zoom=l.zoom,t.level=l.level,t.period=l.format.period,t.leftGlobal=l.leftGlobal,t.centerGlobal=l.centerGlobal,t.rightGlobal=l.rightGlobal,t.from=l.from,t.to=l.to,t.allDates=l.allDates,t.additionalSpaceAdded=l.additionalSpaceAdded,t));w=updateVisibleItems(l,w),w=w.update("$data.chart.time.recalculateTimesLastReason",t.name),w.done(),m&&console.log("Time recalculated.",{time:l}),r("")}s(()=>{T&&T.destroy()}),s(()=>{C.forEach(t=>t())}),s(i.subscribe("config;",()=>{fullReload(),function resetScroll(){i.update("config.scroll",t=>(t.horizontal.dataIndex=0,t.horizontal.data=null,t.horizontal.posPx=0,t.vertical.dataIndex=0,t.vertical.data=Object.values(i.get("config.list.rows"))[0],t.vertical.posPx=0,t))}(),setTimeout(triggerLoadedEvent,0)})),s(i.subscribe("config.chart.items",(t,e)=>{e.options.data&&"updateVisibleItems"===e.options.data||updateVisibleItems().done()},{bulk:!0,ignore:["config.chart.items.*.selected","config.chart.items.*.selecting","config.chart.items.*.moving"]}));const O={initialized:!1,zoom:0,period:"",scrollDataIndex:0,chartWidth:0,from:0,to:0};let _;s(i.subscribeAll(["config.chart.time","$data.chart.time","config.chart.calendar.levels","config.scroll.horizontal.dataIndex","$data.chart.dimensions.width"],()=>{const t=function recalculationIsNeeded(){const t=i.get("config.chart.time"),e=i.get("config.scroll.horizontal.dataIndex"),n=i.get("$data.chart.dimensions.width"),s=Object.assign({},O);return O.zoom=t.zoom,O.period=t.period,O.from=t.from,O.to=t.to,O.scrollDataIndex=e,O.chartWidth=n,O.initialized?!0===t.forceUpdate?(i.update("config.chart.time.forceUpdate",!1),{name:"forceUpdate"}):t.zoom!==s.zoom?{name:"zoom",oldValue:s.zoom,newValue:t.zoom}:t.period!==s.period?{name:"period",oldValue:s.period,newValue:t.period}:t.from!==s.from?{name:"from",oldValue:s.from,newValue:t.from}:t.to!==s.to?{name:"to",oldValue:s.to,newValue:t.to}:e!==s.scrollDataIndex?{name:"scroll",oldValue:s.scrollDataIndex,newValue:e}:n!==s.chartWidth?{name:"chartWidth",oldValue:s.chartWidth,newValue:n}:{name:""}:(O.initialized=!0,{name:"all"})}();t.name&&recalculateTimes(t)},{bulk:!0})),s(i.subscribe("config.chart.items.:itemId.time",t=>{const e=i.get("$data.chart.time"),s=n.getAllItems();for(const n of t){const t=s[n.params.itemId];if(!t)return;if(t.time.start<e.from||t.time.end>e.to){let n=e.from,i=e.to;return t.time.start<e.from&&(n=t.time.start),t.time.end>e.to&&(i=t.time.end),recalculateTimes({name:"items",from:n,to:i})}}},{bulk:!0}));const E=l`
    <br />
    If you are using trial version, please generate key
    <a href="https://gstc.neuronet.io/trial-key" target="_blank">here</a>. Otherwise, please contact with your developer
    or send mail to us at <a href="mailto:neuronet.io@gmail.com">neuronet.io@gmail.com</a>
  `,R=l`
    <div class="gstc-error">
      <div style="font-weight: bold;margin-bottom:10px;">[ Connection error ]</div>
      An error occurred while trying to connect with license services for
      <a href="https://github.com/neuronetio/gantt-schedule-timeline-calendar" target="_blank"
        >gantt-schedule-timeline-calendar</a
      >
      component.<br /><br />
      If you are using <span class="gstc-code">Content-Security-Policy</span> header make sure you have added
      <span class="gstc-code">https://gstc.neuronet.io</span> address after space.<br />
      Example: <span class="gstc-code">Content-Security-Policy: connect-src self https://gstc.neuronet.io</span><br />
      More info
      <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank"
        >here</a
      >
      and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank">here</a><br /><br />
      If that doesn't help please contact your developer, search for similar
      <a href="https://github.com/neuronetio/gantt-schedule-timeline-calendar/issues">issues here</a> or create one. You
      can also contact us at <a href="mailto:neuronet.io@gmail.com">neuronet.io@gmail.com</a>
    </div>
  `;let A=!0;const L=i.get("config.licenseKey");if(L){const t=encodeURIComponent,e=[`${t("license")}=${t(L)}`,`${t("host")}=${t(location.host)}`,`${t("href")}=${t(location.href)}`].join("&");fetch("https://gstc.neuronet.io/api/license",{method:"POST",redirect:"follow",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}).then(t=>(200!==t.status&&(A=!1,_=R),t.json())).then(t=>{t&&t.ok?A=!0:t?(A=!1,_=l`
            <div class="gstc-error"><strong>${t.message}</strong>${E}</div>
          `):(A=!1,_=R),r()}).catch(()=>{A=!1,_=R,r()})}else A=!1,_=l`
      <div class="gstc-error">
        License key not found [config.licenseKey]${E}
      </div>
    `;const N={width:0,height:0};let z,G,V;class ResizeAction{constructor(t){z||(z=new lt(()=>{const e=t.clientWidth,n=t.clientHeight;N.width===e&&N.height===n||(N.width=e,N.height=n,i.update("$data.dimensions",N))}),z.observe(t),i.update("$data.elements.main",t))}update(){}destroy(t){z.unobserve(t)}}function onWheel(t){const e=n.normalizeMouseWheelEvent(t);if(t.shiftKey||e.x){const t=e.x?e.x:e.y,i=n.getScrollLeft();return void(t>0?n.setScrollLeft(i.dataIndex+G):n.setScrollLeft(i.dataIndex-G))}const i=n.getScrollTop();e.y>0?n.setScrollTop(i.dataIndex+V):n.setScrollTop(i.dataIndex-V)}f.includes(ResizeAction)||f.push(ResizeAction),s(()=>{z.disconnect()}),s(i.subscribe("config.scroll",t=>{G=t.horizontal.multiplier,V=t.vertical.multiplier}));const Y=Object.assign(Object.assign({},e),{api:n,state:i}),H=o.create(f,Y),k=n.generateSlots("main",t,e);return s(k.destroy),()=>A?k.html("outer",l`
            <div
              data-info-url="https://github.com/neuronetio/gantt-schedule-timeline-calendar"
              class=${P}
              style=${v}
              data-actions=${H}
              @wheel=${onWheel}
            >
              ${k.html("content",l`
                  ${I.html()}${T.html()}
                `)}
            </div>
          `):_}function ScrollBar(t,e){const{onDestroy:n,state:i,api:s,html:o,StyleMap:r,Actions:a,update:l,schedule:h}=t;let u,m,p,f="",v="";n(i.subscribe("config.classNames",()=>{u=s.getClass("scroll-bar"),m=s.getClass("scroll-bar-inner")}));const b="horizontal"===e.type?"height":"width",w="height"===b?"width":"height",x="horizontal"===e.type?"left":"top",P=new r({}),C=new r({});let D=0,S=!1,I=[],T=[],O=0,_=0,E=0,R=0;function getFullSize(){return"vertical"===e.type?T.length?s.getRow(T[T.length-1]).$data.position.top+s.getRow(T[T.length-1]).$data.outerHeight:0:I.length?I[I.length-1].rightPx:0}"horizontal"===e.type&&n(i.subscribe("$data.chart.time",()=>{const t=i.get("$data.chart.time");if(t.leftGlobalDate&&(i.get("config.scroll.horizontal").area!==t.scrollWidth&&i.update("config.scroll.horizontal.area",t.scrollWidth),t.allDates&&t.allDates[t.level])){const e=t.allDates[t.level],n=e.find(e=>e.leftGlobal===t.leftGlobal);let o=e.indexOf(n);const r=i.get("config.scroll.horizontal.lastPageCount");o>e.length-r&&(o=e.length-r),s.setScrollLeft(o,t,void 0,"time")}}));const A={maxPosPx:0,innerSize:0,sub:0,scrollArea:0};n(i.subscribeAll("horizontal"===e.type?[`config.scroll.${e.type}`,"$data.chart.time"]:[`config.scroll.${e.type}`,"$data.innerHeight","$data.list.rowsWithParentsExpanded;","$data.list.rowsHeight"],(function scrollThing(){const t=i.get("$data.chart.time"),n=i.get(`config.scroll.${e.type}`),s=i.get("$data.chart.dimensions.width"),o=i.get("$data.innerHeight");S=n.precise,p=n.size,_="horizontal"===e.type?s:o,_=_||0,"horizontal"===e.type?_-=p:_+=p,_<0&&(_=0),P.style[b]=p+"px",P.style[w]=_+"px","vertical"===e.type&&(P.style.top=i.get("config.headerHeight")+"px"),C.style[b]="100%",E=_,"horizontal"===e.type?I=t.allDates&&t.allDates[t.level]?t.allDates[t.level]:[]:T=i.get("$data.list.rowsWithParentsExpanded")||[];const r=getFullSize();i.get(`config.scroll.${e.type}.lastPageSize`)&&(R=0,r<=E||n.lastPageSize===r?(E=0,O=0):(_&&r?O=_*(_/r):(O=0,E=0),O<n.minInnerSize&&(R=n.minInnerSize-O,O=n.minInnerSize)),C.style[w]=O+"px",D=Math.round(_-R),function shouldUpdate(t,e,n,i){const s=A.maxPosPx!==t||A.innerSize!==e||A.sub!==n||A.scrollArea!==i;return s&&(A.maxPosPx=D,A.innerSize=e,A.sub=n,A.scrollArea=i),s}(D,O,R,_)&&i.update(`config.scroll.${e.type}`,t=>(t.maxPosPx=D,t.innerSize=O,t.sub=R,t.scrollArea=_,t)),l())})));let L=0;n(i.subscribe(`config.scroll.${e.type}.posPx`,t=>{t!==L&&(C.style[x]=t+"px",L=t,l())}));const N=s.getActions("scroll-bar");N.push(class OuterAction extends Action{constructor(t){super(),i.update(`$data.elements.scroll-bar--${e.type}`,t)}update(){}destroy(){}});const z=a.create(N,{api:s,state:i,props:e}),G=[class InnerAction extends Action{constructor(t){super(),this.moving=!1,this.initialPos=0,this.currentPos=0,this.cumulation=0,this.lastDataIndex=0,this.dataIndex=0,i.update(`$data.elements.scroll-bar-inner--${e.type}`,t),this.bodyClassName=i.get("config.scroll.bodyClassName"),this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this);const n=this.pointerMove.bind(this);this.pointerMove=h(n),this.unsubscribe=i.subscribe(`config.scroll.${e.type}`,this.dataChanged.bind(this)),this.destroy=this.destroy.bind(this),t.addEventListener("pointerdown",this.pointerDown),document.addEventListener("pointermove",this.pointerMove,{passive:!0}),document.addEventListener("pointerup",this.pointerUp)}destroy(t){this.unsubscribe(),t.removeEventListener("pointerdown",this.pointerDown),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.pointerUp)}dataChanged(){const t=i.get(`config.scroll.${e.type}`),n=t.dataIndex;if(this.lastDataIndex=n,"horizontal"===e.type&&I&&I.length){const t=I[n];if(!t)return;if(this.lastDate&&this.lastDate.leftPercent===t.leftPercent)return;const e=this.limitPosition(t.leftPercent*(_-R));this.currentPos=e,l()}else if("vertical"===e.type){const e=T[n],i=s.getRow(e);if(!i)return;if(this.lastRow&&this.lastRow.$data.position.topPercent===i.$data.position.topPercent)return;const o=Math.round(i.$data.position.topPercent*(_-R));this.currentPos=o+t.offset,l()}}limitPosition(t){return Math.max(Math.min(t,D),0)}pointerDown(t){s.muteMethod("calculateRowsHeight"),t.preventDefault(),t.stopPropagation(),document.body.classList.add(this.bodyClassName),this.moving=!0,this.initialPos="horizontal"===e.type?t.screenX:t.screenY,v=" "+s.getClass("scroll-bar")+"-inner--active",f=" "+s.getClass("scroll-bar")+"--active",l()}pointerUp(t){this.moving&&(s.unmuteMethod("calculateRowsHeight"),t.preventDefault(),t.stopPropagation(),document.body.classList.remove(this.bodyClassName)),this.moving=!1,this.cumulation=0,v="",f="",l()}pointerMove(t){if(this.moving){t.stopPropagation();const n="horizontal"===e.type?t.screenX:t.screenY,i=n-this.initialPos;this.cumulation+=i,this.currentPos=this.limitPosition(this.currentPos+i),this.initialPos=n;const o=this.currentPos/D;let r=0,a=0;if("horizontal"===e.type)for(let t=I.length;r<t;r++){if(I[r].leftPercent>=o)break}else{let t;for(let e=T.length;r<e&&(t=s.getRow(T[r]),!(t.$data.position.bottomPercent>=o));r++);if(r!==t.length-1&&S){const e=o-t.$data.position.topPercent;a=Math.floor(e*getFullSize())}}r||(r=0),this.dataIndex=r,"horizontal"===e.type?(this.lastDate=I[r],s.setScrollLeft(r,void 0,void 0,void 0)):(this.lastRow=s.getRow(T[r]),s.setScrollTop(r,a)),r!==this.lastDataIndex&&(this.cumulation=0),this.lastDataIndex=r}}}],V=a.create(G,{api:s,state:i,props:e}),Y=s.generateSlots("scroll-bar",t,e);return()=>Y.html("outer",o`
        <div
          data-actions=${z}
          class=${u+" "+u+"--"+e.type+f}
          style=${P}
        >
          ${Y.html("inner",o`
              <div
                data-actions=${V}
                class=${m+" "+m+"--"+e.type+v}
                style=${C}
              >
                ${Y.html("content")}
              </div>
            `)}
        </div>
      `)}function List(t,e={}){const{api:n,state:i,onDestroy:s,Actions:o,update:r,reuseComponents:a,html:l,StyleMap:h,cache:u}=t,m=n.getActions("list");let p;const f=i.subscribe("config.components.ListColumn",t=>p=t);!function renderExpanderIcons(){const t=i.get("config.list.expander.icons"),e={};for(const i in t){const s=t[i];e[i]=n.getSVGIconSrc(s)}i.update("$data.list.expander.icons",e)}(),function renderToggleIcons(){const t={open:"",close:""},e=i.get("config.list.toggle.icons");for(const i in e){const s=e[i];t[i]=n.getSVGIconSrc(s)}i.update("$data.list.toggle.icons",t)}();const v=n.getClass("list"),b=n.generateSlots("list",t,e);let w,x;s(i.subscribe("config.list",(function onListChange(){w=i.get("config.list"),x=w.columns.percent,r()})));const P=[];s(i.subscribe("config.list.columns.data",(function onListColumnsDataChange(t){a(P,Object.values(t),t=>({column:t}),p),r()})));const C=new h({height:"","--expander-padding-width":"","--expander-size":""});let D;function getWidth(t){D||(D=t.clientWidth,0===x&&(D=0),i.update("$data.list.width",D))}s(i.subscribeAll(["$data.height","config.list.expander"],()=>{const t=i.get("config.list.expander");C.style.height=i.get("$data.height")+"px",C.style["--expander-padding-width"]=t.padding+"px",C.style["--expander-size"]=t.size+"px",r()})),s(()=>{P.forEach(t=>t.destroy()),f()});m.push(class ListAction{constructor(t,e){e.state.update("$data.elements.list",t),getWidth(t)}update(t){return getWidth(t)}});const S=o.create(m,Object.assign(Object.assign({},e),{api:n,state:i}));return()=>b.html("outer",u(w.columns.percent>0?l`
              <div class=${v} data-actions=${S} style=${C}>
                ${b.html("content",P.map(t=>t.html()))}
              </div>
            `:""))}class BindElementAction{constructor(t,e){let n=!1,i=e.state.get("$data.elements.list-columns");void 0===i&&(i=[],n=!0),i.includes(t)||(i.push(t),n=!0),n&&e.state.update("$data.elements.list-columns",i)}destroy(t,e){e.state.update("$data.elements.list-columns",e=>e.filter(e=>e!==t))}}function ListColumn(t,e){const{api:n,state:i,onDestroy:s,onChange:o,Actions:r,update:a,createComponent:l,reuseComponents:h,html:u,StyleMap:m}=t,p=[];let f,v;p.push(i.subscribe("config.components.ListColumnRow",t=>f=t)),p.push(i.subscribe("config.components.ListColumnHeader",t=>v=t));const b=Object.assign(Object.assign({},e),{api:n,state:i}),w=n.getActions("list-column"),x=n.getActions("list-column-rows");let P,C,D,S;const I=new m({width:"","--width":""}),T=new m({height:""}),O=new m({"margin-top":"0px"}),_=n.generateSlots("list-column",t,e);let E;function calculateStyle(){const t=i.get("config.list");S=t.columns.data[e.column.id].width*t.columns.percent*.01,E=S;const n=i.get("$data.innerHeight");I.style.width=E+"px",I.style["--width"]=E+"px",T.style.height=n+"px"}s(i.subscribeAll(["config.list.columns.percent","config.list.columns.resizer.width","$data.chart.dimensions.width","$data.innerHeight","$data.list.width","$data.list.visibleRowsHeight"],calculateStyle,{bulk:!0}));const R=l(v,e);s(R.destroy);const A=[];function visibleRowsChange(){const t=i.get("$data.list.visibleRows")||[],s=n.getRows(t);h(A,s,t=>t&&{column:e.column,row:t,width:E},f,!1),_.change(e)}o(t=>{e=t,P=n.getClass("list-column",e.column.id),D=n.getClass("list-column-rows-offset",e.column.id),C=n.getClass("list-column-rows",e.column.id);for(const t in e)b[t]=e[t];calculateStyle(),R.change(e),visibleRowsChange()}),s(i.subscribeAll(["$data.list.visibleRows;","$data.list.visibleRowsHeight","config.chart.items.*.height","config.chart.items.*.rowId","config.chart.items.*.time"],visibleRowsChange)),s(i.subscribe("config.scroll.vertical.offset",t=>{O.style.transform=`translateY(-${t||0}px)`,a()})),s(()=>{A.forEach(t=>t.destroy()),p.forEach(t=>t())}),w.push(BindElementAction);const L=r.create(w,{column:e.column,state:i,api:n}),N=r.create(x,{api:n,state:i});return()=>{const t=u`
      <div class=${D} style=${O}>
        ${_.html("content",A.map(t=>t.html()))}
      </div>
    `,e=u`
      <div class=${C} style=${T} data-actions=${N}>
        ${_.html("container-inner",t)}
      </div>
    `;return _.html("outer",u`
        <div class=${P} data-actions=${L} style=${I}>
          ${_.html("inner",u`
              ${R.html()}${_.html("container-outer",e)}
            `)}
        </div>
      `)}}function ListColumnHeader(t,e){const{api:n,state:i,onDestroy:s,onChange:o,Actions:r,update:a,createComponent:l,html:h,cache:u,StyleMap:m}=t,p=Object.assign(Object.assign({},e),{api:n,state:i}),f=n.getActions("list-column-header"),v=[];let b;v.push(i.subscribe("config.components.ListColumnHeaderResizer",t=>b=t));const w=l(b,e);let x;v.push(i.subscribe("config.components.ListColumnRowExpander",t=>x=t));const P=l(x,e);s(()=>{w.destroy(),P.destroy(),v.forEach(t=>t())});const C=n.generateSlots("list-column-header",t,e);let D,S;o(t=>{e=t,D=n.getClass("list-column-header",e.column.id),S=n.getClass("list-column-header-content",e.column.id);for(const t in e)p[t]=e[t];w.change(e),P.change(e),C.change(t)});const I=new m({height:"","--height":"","--paddings-count":""});s(i.subscribe("config.headerHeight",()=>{const t=i.get("config");I.style.height=t.headerHeight+"px",I.style["--height"]=t.headerHeight+"px",I.style["--paddings-count"]="1",a()}));const T=r.create(f,p);return()=>C.html("outer",h`
        <div class=${D} style=${I} data-actions=${T}>
          ${C.html("content",e.column.expander?function withExpander(){return h`
      <div class=${S}>
        ${P.html()}${w.html(e.column)}
      </div>
    `}():function withoutExpander(){return h`
      <div class=${S}>
        ${w.html(e.column)}
      </div>
    `}())}
        </div>
      `)}function ListColumnHeaderResizer(t,e){const{api:n,state:i,onDestroy:s,update:o,html:r,Actions:a,onChange:l,PointerAction:h,StyleMap:u,unsafeHTML:m,cache:p}=t,f="list-column-header-resizer",v=n.getActions(f),b=n.getActions(f+"-dots"),w={up:"",down:""};let x,P,C,D;s(i.subscribe("config.list.sort.icons",t=>{w.up=n.getSVGIconSrc(t.up),w.down=n.getSVGIconSrc(t.down)})),x=n.getClass(f),P=n.getClass(f+"-container"),C=n.getClass(f+"-dots"),D=n.getClass(f+"-dots-dot");const S=n.getClass(f+"-sort-icon");let I;const T=new u({});let O=!1;const _=n.generateSlots(f,t,e);let E=!0;function updateData(){if(!e.column)return;x=n.getClass(f,e.column.id),P=n.getClass(f+"-container",e.column.id),C=n.getClass(f+"-dots",e.column.id),D=n.getClass(f+"-dots-dot",e.column.id),E=!("resizer"in e.column)||e.column.resizer;const t=i.get("config.list");I=e.column.width*t.columns.percent*.01,T.style["--width"]=t.columns.resizer.width+"px",O=t.columns.resizer.inRealTime,i.update("$data.list.width",I),_.change(e),o()}l(t=>{e=t,updateData()}),s(i.subscribeAll(["config.list.columns.percent","config.list.columns.resizer.width","config.list.columns.resizer.inRealTime"],updateData));let R=[1,2,3,4,5,6,7,8];s(i.subscribe("config.list.columns.resizer.dots",t=>{R=[];for(let e=0;e<t;e++)R.push(e);o()}));let A=!0;function onLabelClick(){e.column.sortable&&(i.update("$data.list.sort.activeColumnId",e.column.id),A=!A,n.sortRowsByColumn(e.column,A))}let L=!1;function getIcon(){return e.column.sortable&&L?A?r`
      <img src="${w.down}" class=${S} />
    `:r`
        <img src="${w.up}" class=${S} />
      `:null}s(i.subscribe("$data.list.sort.activeColumnId",t=>{if(t===e.column.id)return L=!0;A=!0,L=!1}));let N=I;const z={column:e.column,api:n,state:i,pointerOptions:{axis:"x",onMove:function onMove({movementX:t,event:n}){if(!E)return;t&&(n.preventDefault(),n.stopPropagation());let s=i.get("config.list.columns.minWidth");"number"==typeof e.column.minWidth&&(s=e.column.minWidth),N+=t,N<s&&(N=s),O&&i.update(`config.list.columns.data.${e.column.id}.width`,N)}}};b.push(h);const G=a.create(v,z),V=a.create(b,z);return()=>{const t=r`
      <div class=${P} @click=${onLabelClick}>
        ${_.html("content",e.column.header.html?m(e.column.header.html):e.column.header.content)}
        ${getIcon()}
      </div>
      <div class=${C} style=${T} data-actions=${V}>
        ${R.map(()=>r`
              <div class=${D} />
            `)}
      </div>
    `,n=r`
      <div class=${P} @click=${onLabelClick}>
        ${_.html("content",e.column.header.html?m(e.column.header.html):e.column.header.content)}
        ${getIcon()}
      </div>
    `;return _.html("outer",r`
        <div class=${x} data-actions=${G}>
          ${_.html("container-outer",E?t:n)}
        </div>
      `)}}class BindElementAction$1{constructor(t,e){let n=e.state.get("$data.elements.list-column-rows"),i=!1;void 0===n&&(i=!0,n=[]),n.includes(t)||(n.push(t),i=!0),i&&e.state.update("$data.elements.list-column-rows",n)}destroy(t,e){e.state.update("$data.elements.list-column-rows",e=>e.filter(e=>e!==t))}}function ListColumnRow(t,e){const{api:n,state:i,onDestroy:s,Detach:o,Actions:r,update:a,html:l,createComponent:h,onChange:u,StyleMap:m,unsafeHTML:p}=t,f="list-column-row",v=Object.assign(Object.assign({},e),{api:n,state:i});let b=!1;const w=new o(()=>b);let x;s(i.subscribe("config.components.ListColumnRowExpander",t=>x=t));const P=new m(e.column.expander?{height:"",top:"","--height":"","--expander-padding-width":"","--expander-size":""}:{height:"",top:"","--height":""},!0),C=h(x,{row:e.row});let D=n.getClass(f),S=n.getClass(f+"-content"),I=n.getClass(f);const T=n.generateSlots(f,t,e);let O;u((function onPropsChange(s,o){if(o.leave||!s||void 0===s.row||void 0===s.column)return b=!0,T.change(s,o),void a();b=!1,e=s;for(const t in e)v[t]=e[t];if(!e.column||!e.row||!e.row.$data)return b=!0,T.change(s,o),void a();if(void 0===e.column||void 0===e.row)return;O=e.column.isHTML?function getHtml(){return void 0===e.row?null:"function"==typeof e.column.data?p(e.column.data({row:e.row,vido:t})):"function"==typeof e.row[e.column.data]?p(e.row[e.column.data]({row:e.row,vido:t})):p(e.row[e.column.data])}():function getText(){return void 0===e.row?null:"function"==typeof e.column.data?e.column.data({row:e.row,vido:t}):"function"==typeof e.row[e.column.data]?e.row[e.column.data]({row:e.row,vido:t}):e.row[e.column.data]}();const r=`${e.row.id}-${e.column.id}`;D=n.getClass(f,r),S=n.getClass(f+"-content",r),I=n.getClass(f);const l=i.get("config.list.expander");P.setStyle({}),P.style.height=e.row.$data.outerHeight+"px",P.style["--height"]=e.row.$data.outerHeight+"px",e.column.expander&&(P.style["--expander-padding-width"]=l.padding*(e.row.$data.parents.length+1)+"px");const h=i.get("config.list.rows");for(const t of e.row.$data.parents){const e=h[t];if("object"==typeof e.style&&"Object"===e.style.constructor.name&&"object"==typeof e.style.children){const t=e.style.children;for(const e in t)P.style[e]=t[e]}}if("object"==typeof e.row.style&&"Object"===e.row.style.constructor.name&&"object"==typeof e.row.style.current){const t=e.row.style.current;for(const e in t)P.style[e]=t[e]}I=e.row.classNames&&e.row.classNames.length?n.getClass(f,r)+" "+e.row.classNames.join(" "):D,C&&C.change(e),T.change(e,o),a()})),s(()=>{C&&C.destroy()});const _=n.getActions(f);_.includes(BindElementAction$1)||_.push(BindElementAction$1);const E=r.create(_,v);return()=>T.html("outer",l`
        <div detach=${w} class=${I} style=${P} data-actions=${E}>
          ${T.html("inner",l`
              ${e.column.expander?C.html():null}
              <div class=${S}>
                ${T.html("content",O)}
              </div>
            `)}
        </div>
      `)}function ListColumnRowExpander(t,e){const{api:n,state:i,onDestroy:s,Actions:o,html:r,createComponent:a,onChange:l,update:h}=t,u="list-column-row-expander",m=n.getActions(u),p=Object.assign(Object.assign({},e),{api:n,state:i});let f,v=n.getClass(u);const b=i.subscribe("config.components.ListColumnRowExpanderToggle",t=>f=t),w=a(f,e.row?{row:e.row}:{});s(()=>{w.destroy(),b()});const x=n.generateSlots(u,t,e);e.row&&l((function onPropsChange(t){e=t,v=n.getClass(u,e.row.id);for(const t in e)p[t]=e[t];w.change(e),x.change(t),h()}));const P=o.create(m,p);return()=>x.html("outer",r`
        <div class=${v} data-action=${P}>
          ${x.html("content",w.html())}
        </div>
      `)}function ListColumnRowExpanderToggle(t,e){const{api:n,state:i,onDestroy:s,Actions:o,update:r,html:a,onChange:l,cache:h}=t,u="list-column-row-expander-toggle",m=Object.assign(Object.assign({},e),{api:n,state:i}),p=n.getActions(u);let f,v,b,w;f=n.getClass(u),v=n.getClass(u+"-child"),b=n.getClass(u+"-open"),w=n.getClass(u+"-closed");let x,P,C,D=!1;s(i.subscribe("$data.list.expander.icons",t=>{t&&(x=t.child,P=t.open,C=t.closed),r()}));const S=n.generateSlots(u,t,e);function expandedChangeRow(t){D=t,r()}let I;function toggle(){D=!D,e.row?i.update(`config.list.rows.${e.row.id}.expanded`,D):i.update("config.list.rows",t=>{for(const e in t)t[e].expanded=D;return t},{only:["*.expanded"]})}e.row?(l((function onPropsChange(t){var s;e=t,f=n.getClass(u,e.row.id),v=n.getClass(u+"-child",e.row.id),b=n.getClass(u+"-open",e.row.id),w=n.getClass(u+"-closed",e.row.id);for(const t in e)m[t]=e[t];I&&I(),(null===(s=null==e?void 0:e.row)||void 0===s?void 0:s.id)&&(I=i.subscribe(`config.list.rows.${e.row.id}.expanded`,expandedChangeRow)),S.change(t)})),s((function listToggleDestroy(){I&&I()}))):s(i.subscribe("config.list.rows.*.expanded",(function expandedChangeNoRow(t){for(const e of t)if(e.value){D=!0;break}r()}),{bulk:!0}));const T=o.create(p,m);return()=>{return S.html("outer",a`
        <div class=${f} data-action=${T} @click=${toggle}>
          ${S.html("content",x?0===(null===(i=null===(n=null===(t=e.row)||void 0===t?void 0:t.$data)||void 0===n?void 0:n.children)||void 0===i?void 0:i.length)?a`
          <img width="16" height="16" class=${v} src=${x} />
        `:D?a`
            <img width="16" height="16" class=${b} src=${P} />
          `:a`
            <img width="16" height="16" class=${w} src=${C} />
          `:"")}
        </div>
      `);var t,n,i}}function ListToggle(t,e={}){const{html:n,onDestroy:i,api:s,state:o,update:r,StyleMap:a}=t,l=s.getClass("list-toggle");let h={open:"",close:""};i(o.subscribe("$data.list.toggle.icons",t=>{t&&(h=t,r())}));const u=new a({top:"0px"});i(o.subscribe("config.scroll.vertical.offset",t=>{u.style.top=(t||0)+"px"}));let m=!0;i(o.subscribe("config.list.columns.percent",t=>m=0!==t));let p=!1;function pointerDown(){p=!0}function pointerUp(){p&&(p=!1,function toggle(){o.update("config.list.columns.percent",t=>0===t?100:0)}())}const f=s.generateSlots("list-toggle",t,e);return()=>f.html("outer",n`
        <div class=${l} style=${u} @pointerdown=${pointerDown} @pointerup=${pointerUp}>
          ${f.html("content",n`
              <img src=${m?h.close:h.open} />
            `)}
        </div>
      `)}function Chart(t,e={}){const{api:n,state:i,onDestroy:s,Actions:o,html:r,createComponent:a}=t,l=[];let h,u,m;l.push(i.subscribe("config.components.ChartCalendar",t=>h=t)),l.push(i.subscribe("config.components.ChartTimeline",t=>u=t)),l.push(i.subscribe("config.components.ScrollBar",t=>m=t));const p=a(h);s(p.destroy);const f=a(u);s(f.destroy);const v=a(m,{type:"horizontal"});s(v.destroy);const b=a(m,{type:"vertical"});s(b.destroy),s(()=>{l.forEach(t=>t())});const w=n.getClass("chart"),x=n.getActions("chart");let P=!1;s(i.subscribe("config.chart.time.calculatedZoomMode",t=>P=t));const C={handleEvent:function onWheelHandler(t){t.type},passive:!1,capture:!1};let D,S=0;x.push((function bindElement(t){D||(D=new lt(()=>{const e=t.clientWidth,n=t.clientHeight,s=e-i.get("config.scroll.horizontal.size");S!==e&&(S=e,i.update("$data.chart.dimensions",{width:e,innerWidth:s,height:n}))}),D.observe(t),i.update("$data.elements.chart",t))})),s(()=>{D.disconnect()});const I=o.create(x,{api:n,state:i}),T=n.generateSlots("chart",t,e);return()=>T.html("outer",r`
        <div class=${w} data-actions=${I} @wheel=${C}>
          ${T.html("content",r`
              ${p.html()}${f.html()}${b.html()}
              ${P?null:v.html()}
            `)}
        </div>
      `)}function ChartCalendar(t,e){const{api:n,state:i,onDestroy:s,Actions:o,update:r,reuseComponents:a,html:l,StyleMap:h}=t,u=n.getActions("chart-calendar"),m=Object.assign(Object.assign({},e),{api:n,state:i}),p=i.get("config.components.ChartCalendarDate"),f=n.getClass("chart-calendar");let v;const b=new h({height:"","--headerHeight":"","margin-left":""});s(i.subscribe("config.headerHeight",t=>{v=t,b.style.height=v+"px",b.style["--calendar-height"]=v+"px",r()}));const w=[[],[]];s(i.subscribe("$data.chart.time.levels",t=>{let e=0;for(const i of t){if(!i.length)continue;let t="YYYY-MM-DD HH";switch(i[0].period){case"day":t="YYYY-MM-DD";break;case"week":t="YYYY-MM-ww";break;case"month":t="YYYY-MM";break;case"year":t="YYYY"}const s=n.time.date().format(t);a(w[e],i,n=>n&&{level:e,date:n,currentDate:s,currentDateFormat:t},p),e++}r()})),s(()=>{w.forEach(t=>t.forEach(t=>t.destroy()))}),u.push(t=>{i.update("$data.elements.chart-calendar",t)});const x=o.create(u,m),P=n.generateSlots("chart-calendar",t,e);return()=>P.html("outer",l`
        <div class=${f} data-actions=${x} style=${b}>
          ${P.html("inner",w.map((t,e)=>l`
                <div class=${f+"-dates "+f+`-dates--level-${e}`}>
                  ${P.html("content",t.map(t=>t.html()))}
                </div>
              `))}
        </div>
      `)}class BindElementAction$2 extends Action{constructor(t,e){super(),e.state.update("$data.elements.chart-calendar-dates",e=>(void 0===e&&(e=[]),e.includes(t)||e.push(t),e))}}function ChartCalendarDay(t,e){const{api:n,state:i,onDestroy:s,Actions:o,update:r,onChange:a,html:l,StyleMap:h,Detach:u}=t,m=n.getActions("chart-calendar-date"),p=n.getClass("chart-calendar-date");let f,v,b="";s(i.subscribe("config.chart.time",t=>f=t));const w=new h({width:"0px"});let x="";function updateDate(){if(!e)return;const t=i.get(`config.chart.calendar.levels.${e.level}`);w.style.width=e.date.currentView.width+"px";const n=t.formats.find(t=>+f.zoom<=+t.zoomTo);b=e.date.current?" gstc-current":e.date.next?" gstc-next":e.date.previous?" gstc-previous":"";let s=p+"-content "+p+`-content--${e.date.period}`+b;n.className?(s+=" "+n.className,x=" "+n.className):x="",v=l`
      <div class=${s}>
        ${e.date.formatted}
      </div>
    `,r()}let P=!1;const C=new u(()=>P),D=n.generateSlots("chart-calendar-date",t,e);let S,I,T;const O={date:e.date,period:e.period,api:n,state:i};a((t,n)=>{if(n.leave)return P=!0,D.change(t,n),r();P=!1,I=e.level===f.level,T=I?p+"--main-date ":p+"--non-main-date ",e=t,O.date=e.date,O.period=e.period,S&&S(),S=i.subscribeAll(["$data.chart.time","config.chart.calendar.levels"],updateDate,{bulk:!0}),D.change(t,n)}),s(()=>{S()}),m.includes(BindElementAction$2)||m.push(BindElementAction$2);const _=o.create(m,O);return()=>D.html("outer",l`
        <div
          detach=${C}
          class=${p+" "+p+`--${e.date.period}`+" "+T+p+`--level-${e.level}`+b+x}
          style=${w}
          data-actions=${_}
        >
          ${D.html("content",v)}
        </div>
      `)}function ChartTimeline(t,e){const{api:n,state:i,onDestroy:s,Action:o,Actions:r,update:a,html:l,createComponent:h,StyleMap:u}=t,m=Object.assign(Object.assign({},e),{api:n,state:i});let p,f,v;s(i.subscribe("config.components.ChartTimelineGrid",t=>{p&&p.destroy(),p=h(t)})),s(()=>{p&&p.destroy()}),s(i.subscribe("config.components.ChartTimelineItems",t=>{f&&f.destroy(),f=h(t)})),s(()=>{f&&f.destroy()}),s(i.subscribe("config.components.ListToggle",t=>{v&&v.destroy(),v=h(t)})),s(()=>{v&&v.destroy()});const b=n.generateSlots("chart-timeline",t,e),w=n.getClass("chart-timeline"),x=n.getClass("chart-timeline-inner");let P;s(i.subscribe("config.list.toggle.display",t=>P=t));const C=new u({}),D=new u({});s(i.subscribeAll(["$data.innerHeight","config.scroll.vertical.offset","$data.chart.dimensions.width","$data.list.visibleRowsHeight","$data.chart.time.dates.day"],(function calculateStyle(){const t=i.get("$data.chart.dimensions.width"),e=i.get("$data.list.visibleRowsHeight");C.style.height=i.get("$data.innerHeight")+"px",C.style["--height"]=C.style.height,t?(C.style.width=t+"px",C.style["--width"]=t+"px"):(C.style.width="0px",C.style["--width"]="0px"),D.style.height=e+"px",D.style.width=t?t+"px":"0px";const n=i.get("config.scroll.vertical.offset")||0;D.style.transform=`translateY(-${n}px)`,a()})));let S=[];s(i.subscribe("config.actions.chart-timeline",t=>{S=t})),S.push(class BindElementAction extends o{constructor(t){super(),i.get("$data.elements.chart-timeline")!==t&&i.update("$data.elements.chart-timeline",t)}});const I=r.create(S,m);return()=>b.html("outer",l`
        <div class=${w} style=${C} data-actions=${I}>
          ${b.html("inner",l`
              <div class=${x} style=${D}>
                ${b.html("content",l`
                    ${p.html()}${f.html()}${P?v.html():""}
                  `)}
              </div>
            `)}
        </div>
      `)}class BindElementAction$3{constructor(t,e){e.state.get("$data.elements.chart-timeline-grid")!==t&&e.state.update("$data.elements.chart-timeline-grid",t)}destroy(t,e){e.state.update("$data.elements",t=>(delete t["chart-timeline-grid"],t))}}function ChartTimelineGrid(t,e){const{api:n,state:i,onDestroy:s,Actions:o,update:r,html:a,reuseComponents:l,StyleMap:h}=t,u=n.getActions("chart-timeline-grid"),m={api:n,state:i},p=i.get("config.components.ChartTimelineGridRow"),f=n.getClass("chart-timeline-grid");let v,b;s(i.subscribe("config.chart.grid.cell.onCreate",t=>v=t)),s(i.subscribe("config.debug",t=>b=t));const w=[];let x={};const P=new Map,C=new h({});s(i.subscribeAll(["$data.list.rowsHeight","$data.list.visibleRows;","$data.list.visibleRowsHeight","config.chart.items.*.rowId","config.chart.items.*.time","$data.chart.time.levels","$data.innerHeight","$data.chart.dimensions.width"],(function generateCells(){b&&console.log("[grid.ts] generateCells");const t=i.get("$data.chart.dimensions.width"),e=i.get("$data.innerHeight"),s=i.get("config.scroll.vertical.offset")||0,o=i.get("$data.chart.time"),r=i.get(`$data.chart.time.levels.${o.level}`);if(!r||0===r.length)return void i.update("$data.chart.grid",{rows:{},cells:{}});const a=i.get("$data.list.visibleRows");C.style.height=e+s+"px",C.style.width=t+"px";let l=0;x={};const h=n.getAllRows(),u={};for(const e of a){const i=h[e];if(!i||!i.$data){b&&console.warn("generateCells EMPTY ROW",{row:i,rowId:e,visibleRowsId:a,rows:h});continue}const s=[];for(const t of r){let e;P.has(t.leftGlobal)?e=P.get(t.leftGlobal):(e=n.time.date(t.leftGlobal).format("YYYY-MM-DDTHH-mm-ss"),P.set(t.leftGlobal,e));let o={id:i.id+"-"+e,time:t,row:i,top:l};for(const t of v)o=t(o);u[o.id]=o,s.push(o.id)}x[e]={row:i,cells:s,top:l,width:t},l+=i.$data.outerHeight}i.update("$data.chart.grid",{rows:x,cells:u})}),{bulk:!0})),s(i.subscribeAll(["$data.chart.grid","config.list.rows"],(function generateRowsComponents(){b&&console.log("[grid.ts] generate rows components");const t=n.getGridRows();l(w,t||[],t=>t,p,!1),r()}))),s(()=>{w.forEach(t=>t.destroy())}),u.push(BindElementAction$3);const D=o.create(u,m),S=n.generateSlots("chart-timeline-grid",t,e);return()=>S.html("outer",a`
        <div class=${f} data-actions=${D} style=${C}>
          ${S.html("content",w.map(t=>t.html()))}
        </div>
      `)}class BindElementAction$4{constructor(t,e){let n=!1,i=e.state.get("$data.elements.chart-timeline-grid-rows");void 0===i&&(i=[],n=!0),i.includes(t)||(i.push(t),n=!0),n&&e.state.update("$data.elements.chart-timeline-grid-rows",i,{only:null})}destroy(t,e){e.state.update("$data.elements.chart-timeline-grid-rows",e=>e.filter(e=>e!==t))}}function ChartTimelineGridRow(t,e){const{api:n,state:i,onDestroy:s,Detach:o,Actions:r,update:a,html:l,reuseComponents:h,onChange:u,StyleMap:m}=t,p="chart-timeline-grid-row",f=Object.assign(Object.assign({},e),{api:n,state:i});let v;s(i.subscribe("config.components.ChartTimelineGridRowCell",t=>v=t));const b=n.getActions(p);let w=n.getClass(p);const x=new m({width:e.width+"px",height:e.row.height+"px"},!0);let P=!1;const C=new o(()=>P),D=n.generateSlots(p,t,e),S=[];u((function onPropsChange(t,s){var o,r,l,u,m,b,C;if(s.leave||void 0===t.row)return P=!0,h(S,[],t=>t,v,!1),D.change(t,s),void a();P=!1,e=t,w=n.getClass(p,e.row.id);const I=n.getGridCells(e.cells);h(S,I,t=>t,v,!1),x.setStyle({}),x.style.height=e.row.$data.outerHeight+"px",x.style.width=e.width+"px";const T=i.get("config.list.rows");for(const t of e.row.$data.parents){const e=T[t],n=null===(l=null===(r=null===(o=null==e?void 0:e.style)||void 0===o?void 0:o.grid)||void 0===r?void 0:r.row)||void 0===l?void 0:l.children;if(n)for(const t in n)x.style[t]=n[t]}const O=null===(C=null===(b=null===(m=null===(u=null==e?void 0:e.row)||void 0===u?void 0:u.style)||void 0===m?void 0:m.grid)||void 0===b?void 0:b.row)||void 0===C?void 0:C.current;if(O)for(const t in O)x.style[t]=O[t];for(const t in e)f[t]=e[t];D.change(t,s)})),s((function destroy(){S.forEach(t=>t.destroy())})),-1===b.indexOf(BindElementAction$4)&&b.push(BindElementAction$4);const I=r.create(b,f);return()=>D.html("outer",l`
        <div detach=${C} class=${w} data-actions=${I} style=${x}>
          ${D.html("content",S.map(t=>t.html()))}
        </div>
      `)}class BindElementAction$5{constructor(t,e){let n=!1,i=e.state.get("$data.elements.chart-timeline-grid-row-cells");void 0===i&&(i=[],n=!0),i.includes(t)||(i.push(t),n=!0),n&&e.state.update("$data.elements.chart-timeline-grid-row-cells",i,{only:null})}destroy(t,e){e.state.update("$data.elements.chart-timeline-grid-row-cells",e=>e.filter(e=>e!==t),{only:[""]})}}function ChartTimelineGridRowCell(t,e){const{api:n,state:i,onDestroy:s,Detach:o,Actions:r,update:a,html:l,onChange:h,StyleMap:u}=t,m="chart-timeline-grid-row-cell",p=Object.assign(Object.assign({},e),{api:n,state:i});let f=!1;const v=new o(()=>f),b=n.getActions(m),w=n.generateSlots(m,t,e);let x;function updateClassName(t){x=n.getClass(m,e.id),t.current&&(x+=" current")}updateClassName(e.time);const P=new u({width:"",height:""});h((function onPropsChange(t,i){var s,o,r,a,l,h,u,m,v,b;if(i.leave||void 0===t.row)return f=!0,void w.change(t,i);f=!1,e=t;for(const t in e)p[t]=e[t];updateClassName(e.time),P.setStyle({}),P.style.width=((null===(s=null==e?void 0:e.time)||void 0===s?void 0:s.width)||0)+"px",P.style.height=((null===(r=null===(o=null==e?void 0:e.row)||void 0===o?void 0:o.$data)||void 0===r?void 0:r.outerHeight)||0)+"px";const x=n.getAllRows();for(const t of e.row.$data.parents){const e=x[t],n=null===(h=null===(l=null===(a=null==e?void 0:e.style)||void 0===a?void 0:a.grid)||void 0===l?void 0:l.cell)||void 0===h?void 0:h.children;n&&P.setStyle(Object.assign(Object.assign({},P.style),n))}const C=null===(b=null===(v=null===(m=null===(u=null==e?void 0:e.row)||void 0===u?void 0:u.style)||void 0===m?void 0:m.grid)||void 0===v?void 0:v.cell)||void 0===b?void 0:b.current;C&&P.setStyle(Object.assign(Object.assign({},P.style),C)),w.change(e,i)})),b.push(BindElementAction$5);const C=r.create(b,p);return()=>w.html("outer",l`
        <div detach=${v} class=${x} data-actions=${C} style=${P}>
          ${w.html("content",null)}
        </div>
      `)}function ChartTimelineItems(t,e={}){const{api:n,state:i,onDestroy:s,Actions:o,update:r,html:a,reuseComponents:l,StyleMap:h}=t;let u,m;s(i.subscribe("config.actions.chart-timeline-items",t=>u=t)),s(i.subscribe("config.components.ChartTimelineItemsRow",t=>m=t));const p=n.getClass("chart-timeline-items"),f=new h({},!0);let v;s(i.subscribeAll(["$data.innerHeight","$data.chart.dimensions.width","config.scroll.vertical.offset"],(function calculateStyle(){const t=i.get("$data.chart.dimensions.width"),e=i.get("$data.innerHeight"),n=i.get("config.scroll.vertical.offset")||0;f.style.width=t+"px",f.style.height=e+n+"px"}))),s(i.subscribe("config.debug",t=>v=t));const b=[];function createRowComponents(){v&&console.log("[items.ts] Updating item & rows components.");const t=i.get("$data.list.visibleRows")||[],e=n.getRows(t);l(b,e,t=>({row:t}),m,!1),r()}s(i.subscribeAll(["$data.list.visibleRows","config.list.rows","config.components.ChartTimelineItemsRow","config.chart.items.*.rowId"],()=>i.last(createRowComponents),{bulk:!0})),s(()=>{b.forEach(t=>t.destroy())});const w=o.create(u,{api:n,state:i}),x=n.generateSlots("chart-timeline-items",t,e);return()=>x.html("outer",a`
        <div class=${p} style=${f} data-actions=${w}>
          ${x.html("content",b.map(t=>t.html()))}
        </div>
      `)}class BindElementAction$6{constructor(t,e){let n=!1,i=e.state.get("$data.elements.chart-timeline-items-rows");void 0===i&&(i=[],n=!0),i.includes(t)||(i.push(t),n=!0),n&&e.state.update("$data.elements.chart-timeline-items-rows",i,{only:null})}destroy(t,e){e.state.update("$data.elements.chart-timeline-items-rows",e=>e.filter(e=>e!==t))}}function ChartTimelineItemsRow(t,e){const{api:n,state:i,onDestroy:s,Detach:o,Actions:r,update:a,html:l,onChange:h,reuseComponents:u,StyleMap:m}=t,p=Object.assign(Object.assign({},e),{api:n,state:i});let f;s(i.subscribe("config.components.ChartTimelineItemsRowItem",t=>f=t));let v="";const b=[],w=new m({width:"",height:""},!0);let x=!1;const P=new o(()=>x);function updateRow(t){if(!t||!t.$data)return x=!0,u(b,[],()=>null,f,!1),a();const s=t.$data.items;if(void 0===s)return x=!0,u(b,[],()=>null,f,!1),a();const o=n.getItems(s);u(b,o,e=>({row:t,item:e}),f,!1),function updateDom(){const t=i.get("$data.chart");x=!1,w.style.width=t.dimensions.width+"px",e?(w.style.height=e.row.$data.outerHeight+"px",w.style["--row-height"]=e.row.$data.outerHeight+"px"):x=!0}(),a()}const C="chart-timeline-items-row";let D=n.getClass(C);const S=n.generateSlots(C,t,e);h((function onPropsChange(t,i){if(i.leave||!t||void 0===t.row)return x=!0,u(b,[],()=>null,f,!1),S.change(t,i),a();e=t,D=n.getClass(C,e.row.id);for(const t in e)p[t]=e[t];v=e.row.classNames&&e.row.classNames.length?D+" "+e.row.classNames.join(" "):D,updateRow(e.row),S.change(t,i),a()})),s(i.subscribe("$data.chart.dimensions.width",()=>updateRow(e.row))),s(()=>{b.forEach(t=>t.destroy())});const I=n.getActions(C);I.push(BindElementAction$6);const T=r.create(I,p);return()=>S.html("outer",l`
        <div detach=${P} class=${v} data-actions=${T} style=${w}>
          ${S.html("content",b.map(t=>t.html()))}
        </div>
      `)}class BindElementAction$7{constructor(t,e){let n=!1,i=e.state.get("$data.elements.chart-timeline-items-row-items");void 0===i&&(i=[],n=!0),i.includes(t)||(i.push(t),n=!0),n&&e.state.update("$data.elements.chart-timeline-items-row-items",i,{only:null})}destroy(t,e){e.state.update("$data.elements.chart-timeline-items-row-items",e=>e.filter(e=>e!==t))}}function ChartTimelineItemsRowItem(t,e){const{api:n,state:i,onDestroy:s,Detach:o,Actions:r,update:a,html:l,svg:h,onChange:u,unsafeHTML:m,StyleMap:p}=t;let f,v,b;s(i.subscribe("config.debug",t=>b=t));let w=0,x=0,P=!1,C="";const D=new p({width:"",height:"",left:"",top:""}),S=new p({}),I=new p({}),T={item:e.item,row:e.row,left:w,width:x,api:n,state:i},O="chart-timeline-items-row-item";let _,E;_=n.getClass(O),E=n.getClass(O+"-label");const R=n.generateSlots(O,t,e);let A,L=!1;function updateItem(t=i.get("$data.chart.time")){var s,o,r,l,h,u,m,p;if(R.change(e,{leave:!1}),P||0===t.levels.length||!t.levels[t.level]||0===t.levels[t.level].length)return L=!0,e.item&&n.setItemData(e.item.id,{detached:L}),a();if(!e.item)return L=!0,a();b&&(console.groupCollapsed("[items-row-item.ts] Update item (before)"),console.log({id:e.item.id,item:e.item}),console.trace(),console.groupEnd());const f=n.getItemData(e.item.id);if(w=f.position.actualLeft,x=f.actualWidth,e.item.time.end<=t.leftGlobal||e.item.time.start>=t.rightGlobal||x<=0)return L=!0,f.detached=L,a();C=_,e.item.time.start<t.leftGlobal?(S.style.display="flex",C+=" "+n.getClass(O+"--left-cut",e.row.id+"-"+e.item.id)):S.style.display="none",f.position.right>t.width?(I.style.display="flex",C+=" "+n.getClass(O+"--right-cut",e.row.id+"-"+e.item.id)):I.style.display="none",e.item.classNames&&e.item.classNames.length&&(C+=" "+e.item.classNames.join(" "));const v=D.style.width,E=D.style.left,A=D.style.top,N=D.style.height;D.setStyle({});const z=n.isItemInViewport(e.item,t.leftGlobal,t.rightGlobal);L=!z,f.detached=L,z?(D.style.width=x+"px",D.style.left=w+"px",D.style.top=f.position.actualTop+"px",D.style.height=f.actualHeight+"px"):(D.style.width=v,D.style.left=E,D.style.top=A,D.style.height=N);const G=n.getAllRows();for(const t of e.row.$data.parents){const e=G[t],n=null===(r=null===(o=null===(s=null==e?void 0:e.style)||void 0===s?void 0:s.items)||void 0===o?void 0:o.item)||void 0===r?void 0:r.children;n&&D.setStyle(Object.assign(Object.assign({},D.style),n))}const V=null===(m=null===(u=null===(h=null===(l=null==e?void 0:e.row)||void 0===l?void 0:l.style)||void 0===h?void 0:h.items)||void 0===u?void 0:u.item)||void 0===m?void 0:m.current;V&&D.setStyle(Object.assign(Object.assign({},D.style),V));const Y=null===(p=null==e?void 0:e.item)||void 0===p?void 0:p.style;Y&&D.setStyle(Object.assign(Object.assign({},D.style),Y)),T.left=w,T.width=x,b&&console.log("[items-row-item.ts] Update item (after)",{id:e.item.id,itemLeftPx:w,itemWidthPx:x,item:e.item}),a()}s(i.subscribe("config.chart.item.cutIcons",t=>{A={left:n.getSVGIconSrc(t.left),right:n.getSVGIconSrc(t.right)}}));const N=n.getClass(O+"-cut"),z=[];function itemUnsub(){z.forEach(t=>t()),z.length=0}function itemSub(t={}){if(itemUnsub(),z.push(i.subscribe(`config.chart.items.${f}`,()=>onPropsChange(e,t))),e.item.linkedWith&&Array.isArray(e.item.linkedWith))for(const n of e.item.linkedWith)z.push(i.subscribe(`config.chart.items.${n}`,()=>onPropsChange(e,t)))}function onPropsChange(t,i){if(i.leave||void 0===t.row||void 0===t.item)return P=!0,L=!0,e.item&&n.setItemData(e.item.id,{detached:L}),R.change(t,i),a();L=!1,n.setItemData(e.item.id,{detached:L}),P=!1,(e=t).item.id===f&&e.row.id===v||(f=e.item.id,v=e.row.id,itemSub(i),_=n.getClass(O,e.row.id+"-"+e.item.id),E=n.getClass(O+"-label",e.row.id+"-"+e.item.id),T.item=e.item,T.row=e.row),updateItem()}itemSub(),u(onPropsChange),s(itemUnsub);const G=n.getActions(O);s(i.subscribe("$data.chart.time",updateItem)),G.push(BindElementAction$7);const V=r.create(G,T),Y=new o(()=>L);function getContent(){return e.item?e.item.isHTML?function getHtml(){return e.item&&e.item.label?"function"==typeof e.item.label?m(e.item.label({item:e.item,vido:t})):m(e.item.label):null}():function getText(){return e.item&&e.item.label?"function"==typeof e.item.label?e.item.label({item:e.item,vido:t}):e.item.label:null}():null}return()=>R.html("outer",l`
        <div detach=${Y} class=${C} data-actions=${V} style=${D}>
          ${R.html("inner",l`
              ${l`
    <div class=${N} style=${S}>
      <img src="${A.left}" class=${N+"-image"} />
    </div>
  `}
              <div class=${E} title=${function getTitle(){return e.item?e.item.isHTML||"function"==typeof e.item.label?"":e.item.label:null}()}>
                ${R.html("content",getContent())}
              </div>
              ${l`
    <div class=${N} style=${I}>
      <img src="${A.right}" class=${N+"-image"} />
    </div>
  `}
            `)}
        </div>
      `)}const ct=["main","scroll-bar","list","list-column","list-column-header","list-column-header-resizer","list-column-header-resizer-dots","list-column-row","list-column-row-expander","list-column-row-expander-toggle","list-toggle","chart","chart-calendar","chart-calendar-date","chart-timeline","chart-timeline-grid","chart-timeline-grid-row","chart-timeline-grid-row-cell","chart-timeline-items","chart-timeline-items-row","chart-timeline-items-row-item"];function generateEmptyActions(){const t={};return ct.forEach(e=>t[e]=[]),t}function generateEmptySlots(){const t={};return ct.forEach(e=>{t[e]={outer:[],inner:[],"container-outer":[],"container-inner":[],content:[]}}),t}var dt=createCommonjsModule((function(t,e){t.exports=function(){var t="millisecond",e="second",n="minute",i="hour",s="day",o="week",r="month",a="quarter",l="year",h=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,u=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},m={s:c,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),s=n%60;return(e<=0?"+":"-")+c(i,2,"0")+":"+c(s,2,"0")},m:function(t,e){var n=12*(e.year()-t.year())+(e.month()-t.month()),i=t.clone().add(n,r),s=e-i<0,o=t.clone().add(n+(s?-1:1),r);return Number(-(n+(e-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(h){return{M:r,y:l,w:o,d:s,D:"date",h:i,m:n,s:e,ms:t,Q:a}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f="en",v={};v[f]=p;var y=function(t){return t instanceof w},M=function(t,e,n){var i;if(!t)return f;if("string"==typeof t)v[t]&&(i=t),e&&(v[t]=e,i=t);else{var s=t.name;v[s]=t,i=s}return!n&&i&&(f=i),i||!n&&f},g=function(t,e){if(y(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new w(n)},b=m;b.l=M,b.i=y,b.w=function(t,e){return g(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var w=function(){function c(t){this.$L=this.$L||M(t.locale,null,!0),this.parse(t)}var m=c.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(b.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(h);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(e)}(t),this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return b},m.isValid=function(){return!("Invalid Date"===this.$d.toString())},m.isSame=function(t,e){var n=g(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return g(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<g(t)},m.$g=function(t,e,n){return b.u(t)?this[e]:this.set(n,t)},m.year=function(t){return this.$g(t,"$y",l)},m.month=function(t){return this.$g(t,"$M",r)},m.day=function(t){return this.$g(t,"$W",s)},m.date=function(t){return this.$g(t,"$D","date")},m.hour=function(t){return this.$g(t,"$H",i)},m.minute=function(t){return this.$g(t,"$m",n)},m.second=function(t){return this.$g(t,"$s",e)},m.millisecond=function(e){return this.$g(e,"$ms",t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,a){var h=this,u=!!b.u(a)||a,m=b.p(t),d=function(t,e){var n=b.w(h.$u?Date.UTC(h.$y,e,t):new Date(h.$y,e,t),h);return u?n:n.endOf(s)},$=function(t,e){return b.w(h.toDate()[t].apply(h.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(e)),h)},p=this.$W,f=this.$M,v=this.$D,w="set"+(this.$u?"UTC":"");switch(m){case l:return u?d(1,0):d(31,11);case r:return u?d(1,f):d(0,f+1);case o:var x=this.$locale().weekStart||0,P=(p<x?p+7:p)-x;return d(u?v-P:v+(6-P),f);case s:case"date":return $(w+"Hours",0);case i:return $(w+"Minutes",1);case n:return $(w+"Seconds",2);case e:return $(w+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(o,a){var h,u=b.p(o),m="set"+(this.$u?"UTC":""),p=(h={},h.day=m+"Date",h.date=m+"Date",h[r]=m+"Month",h[l]=m+"FullYear",h[i]=m+"Hours",h[n]=m+"Minutes",h[e]=m+"Seconds",h[t]=m+"Milliseconds",h)[u],f=u===s?this.$D+(a-this.$W):a;if(u===r||u===l){var v=this.clone().set("date",1);v.$d[p](f),v.init(),this.$d=v.set("date",Math.min(this.$D,v.daysInMonth())).toDate()}else p&&this.$d[p](f);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[b.p(t)]()},m.add=function(t,a){var h,u=this;t=Number(t);var m=b.p(a),d=function(e){var n=g(u);return b.w(n.date(n.date()+Math.round(e*t)),u)};if(m===r)return this.set(r,this.$M+t);if(m===l)return this.set(l,this.$y+t);if(m===s)return d(1);if(m===o)return d(7);var p=(h={},h[n]=6e4,h[i]=36e5,h[e]=1e3,h)[m]||1,f=this.$d.getTime()+t*p;return b.w(f,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var n=t||"YYYY-MM-DDTHH:mm:ssZ",i=b.z(this),s=this.$locale(),o=this.$H,r=this.$m,a=this.$M,l=s.weekdays,h=s.months,c=function(t,i,s,o){return t&&(t[i]||t(e,n))||s[i].substr(0,o)},d=function(t){return b.s(o%12||12,t,"0")},m=s.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:b.s(a+1,2,"0"),MMM:c(s.monthsShort,a,h,3),MMMM:c(h,a),D:this.$D,DD:b.s(this.$D,2,"0"),d:String(this.$W),dd:c(s.weekdaysMin,this.$W,l,2),ddd:c(s.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(o),HH:b.s(o,2,"0"),h:d(1),hh:d(2),a:m(o,r,!0),A:m(o,r,!1),m:String(r),mm:b.s(r,2,"0"),s:String(this.$s),ss:b.s(this.$s,2,"0"),SSS:b.s(this.$ms,3,"0"),Z:i};return n.replace(u,(function(t,e){return e||p[t]||i.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(t,s,h){var u,m=b.p(s),p=g(t),f=6e4*(p.utcOffset()-this.utcOffset()),v=this-p,w=b.m(this,p);return w=(u={},u[l]=w/12,u[r]=w,u[a]=w/3,u[o]=(v-f)/6048e5,u.day=(v-f)/864e5,u[i]=v/36e5,u[n]=v/6e4,u[e]=v/1e3,u)[m]||v,h?w:b.a(w)},m.daysInMonth=function(){return this.endOf(r).$D},m.$locale=function(){return v[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=M(t,e,!0);return i&&(n.$L=i),n},m.clone=function(){return b.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},c}();return g.prototype=w.prototype,g.extend=function(t,e){return t(e,w,g),g},g.locale=M,g.isDayjs=y,g.unix=function(t){return g(1e3*t)},g.en=v[f],g.Ls=v,g}()})),ht=createCommonjsModule((function(t,e){t.exports=function(t,e,n){var i=(new Date).getTimezoneOffset(),s=e.prototype;n.utc=function(t){return new e({date:t,utc:!0,args:arguments})},s.utc=function(){return n(this.toDate(),{locale:this.$L,utc:!0})},s.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var o=s.parse;s.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),o.call(this,t)};var r=s.init;s.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else r.call(this)};var a=s.utcOffset;s.utcOffset=function(t){var e=this.$utils().u;if(e(t))return this.$u?0:e(this.$offset)?a.call(this):this.$offset;var n,s=Math.abs(t)<=16?60*t:t;return 0!==t?(n=this.local().add(s+i,"minute")).$offset=s:n=this.utc(),n};var l=s.format;s.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},s.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+i;return this.$d.valueOf()-6e4*t},s.isUTC=function(){return!!this.$u},s.toISOString=function(){return this.toDate().toISOString()},s.toString=function(){return this.toDate().toUTCString()};var h=s.toDate;s.toDate=function(t){return"s"===t&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)}}}));class Time{constructor(t,e){this.utcMode=!1,this.state=t,this.api=e,this.dayjs=dt,this.locale=t.get("config.locale"),this.utcMode=t.get("config.utcMode"),this.resetCurrentDate(),this.utcMode&&dt.extend(ht),dt.locale(this.locale,null,!0)}resetCurrentDate(){const t=dt();this.currentDate={timestamp:t.valueOf(),hour:t.startOf("hour"),day:t.startOf("day"),week:t.startOf("week"),month:t.startOf("month"),year:t.startOf("year")}}date(t){const e=this.utcMode?dt.utc:dt;return t?e(t).locale(this.locale.name):e().locale(this.locale.name)}addAdditionalSpace(t){if(!t.additionalSpaceAdded&&t.additionalSpaces&&t.additionalSpaces[t.period]){t.additionalSpaceAdded=!0;const e=t.additionalSpaces[t.period];e.before&&(t.from=this.date(t.from).subtract(e.before,e.period).valueOf()),e.after&&(t.to=this.date(t.to).add(e.after,e.period).valueOf()),t.additionalSpaceAdded=!0}return t}recalculateFromTo(t){const e=t.period;(t=Object.assign({},t)).from=+t.from,t.to=+t.to,t.fromDate=this.date(t.from),t.toDate=this.date(t.to).endOf(e);let n=Number.MAX_SAFE_INTEGER,i=0;const s=this.state.get("config.chart.items");if(Object.keys(s).length>0&&(0===t.from||0===t.to)){for(const t in s){const e=s[t];e.time.start<n&&e.time.start&&(n=e.time.start),e.time.end>i&&(i=e.time.end)}0===t.from&&(t.from=this.date(n).startOf(e).valueOf()),0===t.to&&(t.to=this.date(i).endOf(e).valueOf()),t.fromDate=this.date(t.from),t.toDate=this.date(t.to).endOf(e)}return t.from=t.fromDate.startOf(e).valueOf(),t.to=t.toDate.endOf(e).valueOf(),t.additionalSpaceAdded||((t=this.addAdditionalSpace(t)).additionalSpaceAdded=!0),t}getCenter(t){return t.leftGlobal+Math.round((t.rightGlobal-t.leftGlobal)/2)}getGlobalOffsetPxFromDates(t,e=this.state.get("$data.chart.time")){const n=t.valueOf(),i=e.allDates[e.level];if(!i)return-1;let s;for(let t=0,e=i.length;t<e;t++){const e=i[t];if(n<=e.rightGlobal){s=e;break}}if(s)return n<s.leftGlobal?s.leftPx:s.rightPx-(s.rightGlobal-n)/e.timePerPixel;{const n=t.valueOf();if(n<=e.leftGlobal)return 0;if(n>=e.rightGlobal)return e.totalViewDurationPx}}getViewOffsetPxFromDates(t,e=!0,n=this.state.get("$data.chart.time")){const i=this.getGlobalOffsetPxFromDates(t,n)-n.leftPx;return e&&this.limitOffsetPxToView(i),i}limitOffsetPxToView(t,e=this.state.get("$data.chart.time")){return t<0?0:t>e.width?e.width:t}findDateAtOffsetPx(t,e){return e.find(e=>e.leftPx>=t)}findDateAtTime(t,e){return e.find(e=>e.rightGlobal>=t)}getTimeFromViewOffsetPx(t,e=this.state.get("config.chart.time"),n=!0){const i=t+e.leftPx,s=e.allDates[e.level];if(i<0){let t,n=e.fromDate.subtract(1,e.period),s=0;for(let o=0;o<1e3;o++){const o=this.generatePeriodDates({leftDate:n,rightDate:n.add(1,e.period),period:e.period,time:e,level:this.state.get(`config.chart.calendar.levels.${e.level}`),levelIndex:e.level,callOnDate:!0,callOnLevelDates:!1});if(o.length&&(t=o[0],s-=t.width,s<=i))return t.leftGlobal+(i-s)*e.timePerPixel;n=n.subtract(1,e.period).startOf(e.period)}}else if(i>e.totalViewDurationPx){let t,n,s=e.toDate.startOf("day").add(1,"day"),o=e.rightPx;for(let r=0;r<1e3;r++){const r=this.generatePeriodDates({leftDate:s,rightDate:s.add(1,e.period),period:e.period,time:e,level:this.state.get(`config.chart.calendar.levels.${e.level}`),levelIndex:e.level,callOnDate:!0,callOnLevelDates:!1});if(r.length&&(t=r[0],o+=t.width,o>=i))return n&&(t=n),t.rightGlobal-(o-i)*e.timePerPixel;s=s.add(1,e.period).startOf(e.period),n=t}}for(let t=0,o=s.length;t<o;t++){const o=s[t];if(o.rightPx>=i){const t=o.rightGlobal-Math.round((o.rightPx-i)*e.timePerPixel);return n?t+1:t}}return 0}calculateScrollPosPxFromTime(t,e,n){if(n||(n=this.state.get("config.scroll.horizontal")),!n.maxPosPx)return 0;e||(e=this.state.get("$data.chart.time"));const i=this.findDateAtTime(t,e.allDates[e.level]);return Math.round((n.maxPosPx-n.innerSize)*i.leftPercent)}getCurrentFormatForLevel(t,e){return t.formats.find(t=>+e.zoom<=+t.zoomTo)}generatePeriodDates({leftDate:t,rightDate:e,period:n,level:i,levelIndex:s,time:o,callOnDate:r,callOnLevelDates:a}){if(!o.timePerPixel)return[];const l=this.getCurrentFormatForLevel(i,o);let h=0;const u=Math.ceil(e.diff(t,n,!0)/l.periodIncrement);let m=[];for(let e=0;e<u;e++){const e=t.add(l.periodIncrement-1,n).endOf(n),i={leftGlobal:t.valueOf(),leftGlobalDate:t,rightGlobalDate:e,rightGlobal:e.valueOf(),width:0,leftPx:0,rightPx:0,period:n,formatted:null,current:t.valueOf()===this.currentDate[n].valueOf(),previous:t.add(1,n).valueOf()===this.currentDate[n].valueOf(),next:t.subtract(1,n).valueOf()===this.currentDate[n].valueOf()},s=i.rightGlobal-i.leftGlobal;i.width=s/o.timePerPixel,i.leftPx=h,h+=i.width,i.rightPx=h,m.push(i),t=t.add(l.periodIncrement||1,n)}if(r)for(let t=0,e=o.onDate.length;t<e;t++)m=m.map(e=>o.onDate[t]({date:e,format:l,time:o,level:i,levelIndex:s})).filter(t=>null!==t);if(a)for(let t=0,e=o.onLevelDates.length;t<e;t++)m=o.onLevelDates[t]({dates:m,format:l,time:o,level:i,levelIndex:s});return m}getDatesDiffPx(t,e,n,i=!0){if(t.valueOf()===e.valueOf())return 0;const s=n.allDates[n.level];if(0===s.length)return 0;let o=0,r=!1;if(e.valueOf()<t.valueOf()){const n=t;t=e,e=n,r=!0}let a=[];if(t.valueOf()<s[0].leftGlobal){const e=s[0].period,i=n.level,o=this.state.get(`config.chart.calendar.levels.${i}`);a=this.generatePeriodDates({leftDate:t,rightDate:s[0].leftGlobalDate,period:e,level:o,levelIndex:i,time:n,callOnDate:!0,callOnLevelDates:!1})}a=[...a,...s];const l=s[s.length-1].leftGlobalDate;if(e.valueOf()>l.valueOf()){const t=s[0].period,i=n.level,o=this.state.get(`config.chart.calendar.levels.${i}`),r=this.generatePeriodDates({leftDate:e,rightDate:l,period:t,level:o,levelIndex:i,time:n,callOnDate:!0,callOnLevelDates:!1});a=[...a,...r]}const h=this.state.get(`config.chart.calendar.levels.${n.level}`),u=this.getCurrentFormatForLevel(h,n);for(const t of n.onLevelDates)a=t({dates:a,time:n,format:u,level:h,levelIndex:n.level});let m,p,f=!1;for(m of a){if(m.leftGlobal>=t.valueOf()&&(f=!0,p=m),m.rightGlobal>=e.valueOf())break;f&&(o+=m.width)}if(i){let i=(t.valueOf()-m.leftGlobal)/n.timePerPixel;p&&(i=(t.valueOf()-p.leftGlobal)/n.timePerPixel);const s=(e.valueOf()-m.leftGlobal)/n.timePerPixel-i;return r?-o-s:o+s}return r?-o:o}getLeftViewDate(t=this.state.get("$data.chart.time")){if(!t.levels||!t.levels.length)return null;const e=t.levels[t.level];return e.length?e[0]:null}getRightViewDate(t=this.state.get("$data.chart.time")){if(!t.levels||!t.levels.length||!t.levels[t.level])return null;const e=t.levels[t.level];return e.length?e[e.length-1]:null}getLowerPeriod(t){switch(t){case"year":return"month";case"month":return"week";case"week":return"day";case"day":return"hour";case"hour":return"minute";case"minute":return"second";case"second":return"millisecond";default:return t}}getHigherPeriod(t){switch(t){case"month":return"year";case"week":return"month";case"day":return"week";case"hour":return"day";case"minute":return"hour";case"second":return"minute";case"millisecond":return"second";default:return t}}}function Matcher(t,e="*"){this.wchar=e,this.pattern=t,this.segments=[],this.starCount=0,this.minLength=0,this.maxLength=0,this.segStartIndex=0;for(let n=0,i=t.length;n<i;n+=1){const i=t[n];i===e&&(this.starCount+=1,n>this.segStartIndex&&this.segments.push(t.substring(this.segStartIndex,n)),this.segments.push(i),this.segStartIndex=n+1)}this.segStartIndex<t.length&&this.segments.push(t.substring(this.segStartIndex)),this.starCount?(this.minLength=t.length-this.starCount,this.maxLength=1/0):this.maxLength=this.minLength=t.length}function WildcardObject(t,e,n,i){this.obj=t,this.delimeter=e,this.wildcard=n,this.is_match=i}Matcher.prototype.match=function match(match){if(this.pattern===this.wchar)return!0;if(0===this.segments.length)return this.pattern===match;const{length:t}=match;if(t<this.minLength||t>this.maxLength)return!1;let e=this.segments.length-1,n=match.length-1,i=!1;for(;;){const t=this.segments[e];if(e-=1,t===this.wchar)i=!0;else{const e=n+1-t.length,s=match.lastIndexOf(t,e);if(-1===s||s>e)return!1;if(i)n=s-1,i=!1;else{if(s!==e)return!1;n-=t.length}}if(0>e)break}return!0},WildcardObject.prototype.simpleMatch=function simpleMatch(t,e){if(t===e)return!0;if(t===this.wildcard)return!0;if(this.is_match)return this.is_match(t,e);const n=t.indexOf(this.wildcard);if(n>-1){const i=t.substr(n+1);if(0===n||e.substring(0,n)===t.substring(0,n)){const t=i.length;return!(t>0)||e.substr(-t)===i}}return!1},WildcardObject.prototype.match=function match(t,e){return this.is_match?this.is_match(t,e):t===e||t===this.wildcard||e===this.wildcard||this.simpleMatch(t,e)||new Matcher(t).match(e)},WildcardObject.prototype.handleArray=function handleArray(t,e,n,i,s={}){let o=t.indexOf(this.delimeter,n),r=!1;-1===o&&(r=!0,o=t.length);const a=t.substring(n,o);let l=0;for(const n of e){const e=l.toString(),h=""===i?e:i+this.delimeter+l;(a===this.wildcard||a===e||this.simpleMatch(a,e))&&(r?s[h]=n:this.goFurther(t,n,o+1,h,s)),l++}return s},WildcardObject.prototype.handleObject=function handleObject(t,e,n,i,s={}){let o=t.indexOf(this.delimeter,n),r=!1;-1===o&&(r=!0,o=t.length);const a=t.substring(n,o);for(let n in e){n=n.toString();const l=""===i?n:i+this.delimeter+n;(a===this.wildcard||a===n||this.simpleMatch(a,n))&&(r?s[l]=e[n]:this.goFurther(t,e[n],o+1,l,s))}return s},WildcardObject.prototype.goFurther=function goFurther(t,e,n,i,s={}){return Array.isArray(e)?this.handleArray(t,e,n,i,s):this.handleObject(t,e,n,i,s)},WildcardObject.prototype.get=function get(t){return this.goFurther(t,this.obj,0,"")};class ObjectPath{static get(t,e,n=!1){if(!e)return;let i=e;for(const e of t)if(i.hasOwnProperty(e))i=i[e];else{if(!n)return;i[e]={},i=i[e]}return i}static set(t,e,n){if(!n)return;if(0===t.length){for(const t in e)n[t]=e[t];return}const i=t.slice(),s=i.pop(),o=ObjectPath.get(i,n,!0);return"object"==typeof o&&(o[s]=e),e}}let ut,mt=0,pt=null;function getUint8Memory0(){return null!==pt&&pt.buffer===ut.memory.buffer||(pt=new Uint8Array(ut.memory.buffer)),pt}let ft=new TextEncoder("utf-8");const gt="function"==typeof ft.encodeInto?function(t,e){return ft.encodeInto(t,e)}:function(t,e){const n=ft.encode(t);return e.set(n),{read:t.length,written:n.length}};function passStringToWasm0(t,e,n){if(void 0===n){const n=ft.encode(t),i=e(n.length);return getUint8Memory0().subarray(i,i+n.length).set(n),mt=n.length,i}let i=t.length,s=e(i);const o=getUint8Memory0();let r=0;for(;r<i;r++){const e=t.charCodeAt(r);if(e>127)break;o[s+r]=e}if(r!==i){0!==r&&(t=t.slice(r)),s=n(s,i,i=r+3*t.length);const e=getUint8Memory0().subarray(s+r,s+i);r+=gt(t,e).written}return mt=r,s}function is_match(t,e){var n=passStringToWasm0(t,ut.__wbindgen_malloc,ut.__wbindgen_realloc),i=mt,s=passStringToWasm0(e,ut.__wbindgen_malloc,ut.__wbindgen_realloc),o=mt;return 0!==ut.is_match(n,i,s,o)}async function init(t){("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:n}=await async function load(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,{});return ut=e.exports,init.__wbindgen_wasm_module=n,ut}var __awaiter$1=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function fulfilled(t){try{step(i.next(t))}catch(t){o(t)}}function rejected(t){try{step(i.throw(t))}catch(t){o(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((i=i.apply(t,e||[])).next())}))};function log(t,e){console.debug(t,e)}const vt={bulk:!1,debug:!1,source:"",data:void 0,queue:!1},bt={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};class DeepState{constructor(t={},e={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.destroyed=!1,this.queueRuns=0,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.data=t,this.options=Object.assign(Object.assign({},function getDefaultOptions(){return{delimeter:".",useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:log,Promise:Promise}}()),e),this.id=0,this.pathGet=ObjectPath.get,this.pathSet=ObjectPath.set,e.Promise?this.resolved=e.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.scan=new WildcardObject(this.data,this.options.delimeter,this.options.wildcard),this.destroyed=!1}loadWasmMatcher(t){return __awaiter$1(this,void 0,void 0,(function*(){yield init(t),this.is_match=is_match,this.scan=new WildcardObject(this.data,this.options.delimeter,this.options.wildcard,this.is_match)}))}same(t,e){return(["number","string","undefined","boolean"].includes(typeof t)||null===t)&&e===t}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(t,e){return this.is_match?this.is_match(t,e):t===e||(t===this.options.wildcard||e===this.options.wildcard||this.scan.match(t,e))}getIndicesOf(t,e){const n=t.length;if(0==n)return[];let i,s=0,o=[];for(;(i=e.indexOf(t,s))>-1;)o.push(i),s=i+n;return o}getIndicesCount(t,e){const n=t.length;if(0==n)return 0;let i,s=0,o=0;for(;(i=e.indexOf(t,s))>-1;)o++,s=i+n;return o}cutPath(t,e){t=this.cleanNotRecursivePath(t),e=this.cleanNotRecursivePath(e);const n=this.getIndicesCount(this.options.delimeter,e),i=this.getIndicesOf(this.options.delimeter,t);return t.substr(0,i[n])}trimPath(t){return(t=this.cleanNotRecursivePath(t)).charAt(0)===this.options.delimeter?t.substr(1):t}split(t){return""===t?[]:t.split(this.options.delimeter)}isWildcard(t){return t.includes(this.options.wildcard)||this.hasParams(t)}isNotRecursive(t){return t.endsWith(this.options.notRecursive)}cleanNotRecursivePath(t){return this.isNotRecursive(t)?t.substring(0,t.length-1):t}hasParams(t){return t.includes(this.options.param)}getParamsInfo(t){let e={replaced:"",original:t,params:{}},n=0,i=[];for(const s of this.split(t)){e.params[n]={original:s,replaced:"",name:""};const t=new RegExp(`\\${this.options.param}([^\\${this.options.delimeter}\\${this.options.param}]+)`,"g");let o=t.exec(s);o?(e.params[n].name=o[1],t.lastIndex=0,e.params[n].replaced=s.replace(t,this.options.wildcard),i.push(e.params[n].replaced),n++):(delete e.params[n],i.push(s),n++)}return e.replaced=i.join(this.options.delimeter),e}getParams(t,e){if(!t)return;const n=this.split(e),i={};for(const e in t.params){i[t.params[e].name]=n[e]}return i}waitForAll(t,e){const n={};for(let e of t)n[e]={dirty:!1},this.hasParams(e)&&(n[e].paramsInfo=this.getParamsInfo(e)),n[e].isWildcard=this.isWildcard(e),n[e].isRecursive=!this.isNotRecursive(e);return this.waitingListeners.set(t,{fn:e,paths:n}),e(n),function unsubscribe(){this.waitingListeners.delete(t)}}executeWaitingListeners(t){if(!this.destroyed)for(const e of this.waitingListeners.values()){const{fn:n,paths:i}=e;let s=0,o=0;for(let e in i){const n=i[e];let r=!1;n.isRecursive&&(t=this.cutPath(t,e)),n.isWildcard&&this.match(e,t)&&(r=!0),t===e&&(r=!0),r&&(n.dirty=!0),n.dirty&&s++,o++}s===o&&n(i)}}subscribeAll(t,e,n=vt){if(this.destroyed)return()=>{};let i=[];for(const s of t)i.push(this.subscribe(s,e,n));return function unsubscribe(){for(const t of i)t()}}getCleanListenersCollection(t={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},t)}getCleanListener(t,e=vt){return{fn:t,options:Object.assign(Object.assign({},vt),e)}}getListenerCollectionMatch(t,e,n){t=this.cleanNotRecursivePath(t);const i=this;return function listenerCollectionMatch(s){return e&&(s=i.cutPath(s,t)),!(!n||!i.match(t,s))||t===s}}getListenersCollection(t,e){if(this.listeners.has(t)){let n=this.listeners.get(t);return n.listeners.set(++this.id,e),n}const n=this.hasParams(t);let i;n&&(i=this.getParamsInfo(t));let s={isRecursive:!this.isNotRecursive(t),isWildcard:this.isWildcard(t),hasParams:n,paramsInfo:i,originalPath:t,path:n?i.replaced:t},o=this.getCleanListenersCollection(Object.assign(Object.assign({},s),{match:this.getListenerCollectionMatch(s.path,s.isRecursive,s.isWildcard)}));return this.id++,o.listeners.set(this.id,e),this.listeners.set(s.originalPath,o),o}subscribe(t,e,n=vt,i="subscribe"){if(this.destroyed)return()=>{};this.jobsRunning++;let s=this.getCleanListener(e,n);this.listenersIgnoreCache.set(s,{truthy:[],falsy:[]});const o=this.getListenersCollection(t,s);o.count++;const r=this.cleanNotRecursivePath(o.path);if(o.isWildcard){const a=this.scan.get(r);if(n.bulk){const r=[];for(const t in a)this.isMuted(t)||r.push({path:t,params:this.getParams(o.paramsInfo,t),value:a[t]});e(r,{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const r in a)this.isMuted(r)||e(a[r],{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(o.paramsInfo,r),options:n})}else this.isMuted(r)||e(this.pathGet(this.split(r),this.data),{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(t)},params:this.getParams(o.paramsInfo,r),options:n});return this.debugSubscribe(s,o,t),this.jobsRunning--,this.unsubscribe(t,this.id)}unsubscribe(t,e){const n=this.listeners,i=n.get(t);return function unsub(){i.listeners.delete(e),i.count--,0===i.count&&n.delete(t)}}runQueuedListeners(){if(!this.destroyed&&0!==this.subscribeQueue.length)if(0===this.jobsRunning){this.queueRuns=0;const t=[...this.subscribeQueue];for(let e=0,n=t.length;e<n;e++)t[e]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then(()=>this.runQueuedListeners()).catch(t=>{throw t})}}notifyListeners(t,e=[],n=!0){const i=[];for(const s in t){if(this.isMuted(s))continue;let{single:o,bulk:r}=t[s];for(const t of o){if(e.includes(t))continue;const s=this.debugTime(t);t.listener.options.queue&&this.jobsRunning?this.subscribeQueue.push(()=>{t.listener.fn(t.value(),t.eventInfo)}):t.listener.fn(t.value(),t.eventInfo),n&&i.push(t),this.debugListener(s,t)}for(const t of r){if(e.includes(t))continue;const s=this.debugTime(t),o=[];for(const e of t.value)o.push(Object.assign(Object.assign({},e),{value:e.value()}));t.listener.options.queue&&this.jobsRunning?this.subscribeQueue.push(()=>!this.jobsRunning&&(t.listener.fn(o,t.eventInfo),!0)):t.listener.fn(o,t.eventInfo),n&&i.push(t),this.debugListener(s,t)}}return Promise.resolve().then(()=>this.runQueuedListeners()),i}shouldIgnore(t,e){if(!t.options.ignore)return!1;for(const n of t.options.ignore){if(e.startsWith(n))return!0;if(this.is_match&&this.is_match(n,e))return!0;{const t=this.cutPath(e,n);if(this.match(n,t))return!0}}return!1}getSubscribedListeners(t,e,n,i="update",s=null){n=Object.assign(Object.assign({},bt),n);const o={};for(let[r,a]of this.listeners)if(o[r]={single:[],bulk:[],bulkData:[]},a.match(t)){const l=a.paramsInfo?this.getParams(a.paramsInfo,t):void 0,h=this.cutPath(t,r),u=a.isRecursive||a.isWildcard?()=>this.get(h):()=>e,m=[{value:u,path:t,params:l}];for(const e of a.listeners.values())this.shouldIgnore(e,t)||(e.options.bulk?o[r].bulk.push({listener:e,listenersCollection:a,eventInfo:{type:i,listener:e,path:{listener:r,update:s||t,resolved:void 0},params:l,options:n},value:m}):o[r].single.push({listener:e,listenersCollection:a,eventInfo:{type:i,listener:e,path:{listener:r,update:s||t,resolved:this.cleanNotRecursivePath(t)},params:l,options:n},value:u}))}return o}notifySubscribedListeners(t,e,n,i="update",s=null){return this.notifyListeners(this.getSubscribedListeners(t,e,n,i,s))}getNestedListeners(t,e,n,i="update",s=null){const o={};for(let[r,a]of this.listeners){o[r]={single:[],bulk:[]};const l=this.cutPath(r,t);if(this.match(l,t)){const h=this.trimPath(r.substr(l.length)),u=new WildcardObject(e,this.options.delimeter,this.options.wildcard).get(h),m=a.paramsInfo?this.getParams(a.paramsInfo,t):void 0,p=[],f={};for(const e in u){const value=()=>u[e],l=[t,e].join(this.options.delimeter);for(const[e,h]of a.listeners){const u={type:i,listener:h,listenersCollection:a,path:{listener:r,update:s||t,resolved:this.cleanNotRecursivePath(l)},params:m,options:n};this.shouldIgnore(h,t)||(h.options.bulk?(p.push({value:value,path:l,params:m}),f[e]=h):o[r].single.push({listener:h,listenersCollection:a,eventInfo:u,value:value}))}}for(const e in f){const s=f[e],l={type:i,listener:s,listenersCollection:a,path:{listener:r,update:t,resolved:void 0},options:n,params:m};o[r].bulk.push({listener:s,listenersCollection:a,eventInfo:l,value:p})}}}return o}notifyNestedListeners(t,e,n,i="update",s,o=null){return this.notifyListeners(this.getNestedListeners(t,e,n,i,o),s,!1)}getNotifyOnlyListeners(t,e,n,i="update",s=null){const o={};if("object"!=typeof n.only||!Array.isArray(n.only)||void 0===n.only[0]||!this.canBeNested(e))return o;for(const r of n.only){const a=new WildcardObject(e,this.options.delimeter,this.options.wildcard).get(r);o[r]={bulk:[],single:[]};for(const e in a){const l=t+this.options.delimeter+e;for(const[h,u]of this.listeners){const m=u.paramsInfo?this.getParams(u.paramsInfo,l):void 0;if(this.match(h,l)){const value=()=>a[e],p=[{value:value,path:l,params:m}];for(const e of u.listeners.values()){const a={type:i,listener:e,listenersCollection:u,path:{listener:h,update:s||t,resolved:this.cleanNotRecursivePath(l)},params:m,options:n};this.shouldIgnore(e,t)||(e.options.bulk?o[r].bulk.some(t=>t.listener===e)||o[r].bulk.push({listener:e,listenersCollection:u,eventInfo:a,value:p}):o[r].single.push({listener:e,listenersCollection:u,eventInfo:a,value:value}))}}}}}return o}notifyOnly(t,e,n,i="update",s=""){return void 0!==this.notifyListeners(this.getNotifyOnlyListeners(t,e,n,i,s))[0]}canBeNested(t){return"object"==typeof t&&null!==t}getUpdateValues(t,e,n){let i=n;return"function"==typeof n&&(i=n(this.pathGet(e,this.data))),{newValue:i,oldValue:t}}wildcardNotify(t,e){let n=[];for(const e of t){const t=this.notifyListeners(e,n);for(const e of t)n.push(e)}for(const t of e)this.executeWaitingListeners(t);this.jobsRunning--}wildcardUpdate(t,e,n=bt,i=!1){++this.jobsRunning,n=Object.assign(Object.assign({},bt),n);const s=this.scan.get(t),o={};for(const t in s){const i=this.split(t),{oldValue:r,newValue:a}=this.getUpdateValues(s[t],i,e);this.same(a,r)&&!n.force||(this.pathSet(i,a,this.data),o[t]=a)}const r=[],a=[];for(const e in o){const i=o[e];n.only.length?r.push(this.getNotifyOnlyListeners(e,i,n,"update",t)):(r.push(this.getSubscribedListeners(e,i,n,"update",t)),this.canBeNested(i)&&r.push(this.getNestedListeners(e,i,n,"update",t))),n.debug&&this.options.log("Wildcard update",{path:e,newValue:i}),a.push(e)}if(i){const t=this;return function(){return t.wildcardNotify(r,a)}}this.wildcardNotify(r,a)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const t=this.updateQueue.shift();t.options.queue=!1,this.update(t.updatePath,t.fnOrValue,t.options,t.multi)}}updateNotify(t,e,n){const i=this.notifySubscribedListeners(t,e,n);this.canBeNested(e)&&this.notifyNestedListeners(t,e,n,"update",i),this.executeWaitingListeners(t)}updateNotifyOnly(t,e,n){this.notifyOnly(t,e,n),this.executeWaitingListeners(t)}update(t,e,n=Object.assign({},bt),i=!1){if(this.destroyed)return;const s=this.jobsRunning;if((this.options.queue||n.queue)&&s){if(s>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:t,fnOrValue:e,options:n,multi:i});const o=Promise.resolve().then(()=>{this.runUpdateQueue()});return i?function(){return o}:o}if(this.isWildcard(t))return this.wildcardUpdate(t,e,n,i);++this.jobsRunning;const o=this.split(t),{oldValue:r,newValue:a}=this.getUpdateValues(this.pathGet(o,this.data),o,e);if(n.debug&&this.options.log(`Updating ${t} ${n.source?`from ${n.source}`:""}`,{oldValue:r,newValue:a}),this.same(a,r)&&!n.force)return--this.jobsRunning,i?function(){return a}:a;if(this.pathSet(o,a,this.data),null===(n=Object.assign(Object.assign({},bt),n)).only)return--this.jobsRunning,i?function(){}:a;if(n.only.length){if(--this.jobsRunning,i){const e=this;return function(){return e.updateNotifyOnly(t,a,n)}}return this.updateNotifyOnly(t,a,n),a}if(i){--this.jobsRunning;const e=this;return function(){return e.updateNotify(t,a,n)}}return this.updateNotify(t,a,n),--this.jobsRunning,a}multi(){if(this.destroyed)return{update(){},done(){}};const t=this,e=[];return{update(n,i,s=bt){return e.push(t.update(n,i,s,!0)),this},done(){for(let t=0,n=e.length;t<n;t++)e[t]();e.length=0}}}get(t){if(!this.destroyed)return void 0===t||""===t?this.data:this.pathGet(this.split(t),this.data)}last(t){let e=this.lastExecs.get(t);e||(e={calls:0},this.lastExecs.set(t,e));const n=++e.calls;this.resolved.then(()=>{n===e.calls&&(this.lastExecs.set(t,{calls:0}),t())})}isMuted(t){if(!this.options.useMute)return!1;for(const e of this.muted){if(this.match(t,e))return!0;if(this.match(e,t))return!0}return!1}mute(t){this.muted.add(t)}unmute(t){this.muted.delete(t)}debugSubscribe(t,e,n){t.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:t,listenersCollection:e})}debugListener(t,e){(e.eventInfo.options.debug||e.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-t,info:e})}debugTime(t){return t.listener.options.debug||t.eventInfo.options.debug?Date.now():0}}class Slots$1 extends Slots{constructor(t,e,n){super(e,n),this.subs=[],this.name=t,this.subs.push(e.state.subscribe(`config.slots.${t}`,this.setComponents,{queue:!0}))}destroy(){this.subs.forEach(t=>t()),super.destroy()}getName(){return this.name}}function generateSlots(t,e,n){return new Slots$1(t,e,n)}const yt=B.mergeDeep,wt="gstc";function getClass(t,e=""){let n=`gstc__${t}`;return t===wt&&(n=wt),e?`${n} ${n}--${e.replace(":","-")}`:n}function getId(t,e){let n=`gstc__${t}`;return t===wt&&(n=wt),`${n}--${e}`}function prepareState(t){let e=function merge(t,e){return B.mergeDeep(t,e)};"function"==typeof t.merge&&(e=t.merge);const n=function defaultConfig(){return{licenseKey:"",debug:!1,plugins:[],plugin:{},innerHeight:428,headerHeight:72,components:{Main:Main,ScrollBar:ScrollBar,List:List,ListColumn:ListColumn,ListColumnHeader:ListColumnHeader,ListColumnHeaderResizer:ListColumnHeaderResizer,ListColumnRow:ListColumnRow,ListColumnRowExpander:ListColumnRowExpander,ListColumnRowExpanderToggle:ListColumnRowExpanderToggle,ListToggle:ListToggle,Chart:Chart,ChartCalendar:ChartCalendar,ChartCalendarDate:ChartCalendarDay,ChartTimeline:ChartTimeline,ChartTimelineGrid:ChartTimelineGrid,ChartTimelineGridRow:ChartTimelineGridRow,ChartTimelineGridRowCell:ChartTimelineGridRowCell,ChartTimelineItems:ChartTimelineItems,ChartTimelineItemsRow:ChartTimelineItemsRow,ChartTimelineItemsRowItem:ChartTimelineItemsRowItem},slots:generateEmptySlots(),list:{rows:{},row:{height:40,gap:{top:0,bottom:0}},columns:{percent:100,resizer:{width:10,inRealTime:!0,dots:6},minWidth:50,data:{}},expander:{padding:18,size:20,icon:{width:16,height:16},icons:{child:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><ellipse ry="4" rx="4" id="svg_1" cy="12" cx="12" fill="#000000B0"/></svg>',open:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>',closed:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>'}},toggle:{display:!0,icons:{open:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path stroke="null" d="m16.406954,16.012672l4.00393,-4.012673l-4.00393,-4.012673l1.232651,-1.232651l5.245324,5.245324l-5.245324,5.245324l-1.232651,-1.232651z"/><path stroke="null" d="m-0.343497,12.97734zm1.620144,0l11.341011,0l0,-1.954681l-11.341011,0l0,1.954681zm0,3.909362l11.341011,0l0,-1.954681l-11.341011,0l0,1.954681zm0,-9.773404l0,1.95468l11.341011,0l0,-1.95468l-11.341011,0z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path transform="rotate(-180 4.392796516418457,12) " stroke="null" d="m1.153809,16.012672l4.00393,-4.012673l-4.00393,-4.012673l1.232651,-1.232651l5.245324,5.245324l-5.245324,5.245324l-1.232651,-1.232651z"/><path stroke="null" d="m9.773297,12.97734zm1.620144,0l11.341011,0l0,-1.954681l-11.341011,0l0,1.954681zm0,3.909362l11.341011,0l0,-1.954681l-11.341011,0l0,1.954681zm0,-9.773404l0,1.95468l11.341011,0l0,-1.95468l-11.341011,0z"/></svg>'}},sort:{compare:null,icons:{up:'<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>',down:'<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>'}}},scroll:{bodyClassName:"gstc-scrolling",horizontal:{size:20,minInnerSize:40,data:null,posPx:0,maxPosPx:0,area:0,multiplier:3,offset:0,precise:!1},vertical:{size:20,minInnerSize:40,data:null,posPx:0,maxPosPx:0,area:0,multiplier:3,offset:0,precise:!1}},chart:{time:{period:"day",from:0,to:0,zoom:20,leftGlobal:0,centerGlobal:0,rightGlobal:0,levels:[],calculatedZoomMode:!1,onLevelDates:[],onCurrentViewLevelDates:[],onDate:[],allDates:[],additionalSpaceAdded:!1},calendar:{expand:!0,levels:[{formats:[{zoomTo:17,period:"day",periodIncrement:1,className:"gstc-date-medium gstc-date-left",format:({timeStart:t})=>t.format("DD MMMM YYYY (dddd)")},{zoomTo:23,period:"month",periodIncrement:1,format:({timeStart:t})=>t.format("MMMM YYYY")},{zoomTo:24,period:"month",periodIncrement:1,format:({timeStart:t})=>t.format("MMMM 'YY")},{zoomTo:25,period:"month",periodIncrement:1,format:({timeStart:t})=>t.format("MMM YYYY")},{zoomTo:27,period:"year",periodIncrement:1,format:({timeStart:t})=>t.format("YYYY")},{zoomTo:100,period:"year",default:!0,periodIncrement:1,format:()=>null}]},{formats:[{zoomTo:16,period:"hour",main:!0,periodIncrement:1,format:({timeStart:t})=>t.format("HH:mm")},{zoomTo:17,period:"hour",default:!0,main:!0,periodIncrement:1,format:({timeStart:t})=>t.format("HH")},{zoomTo:19,period:"day",main:!0,periodIncrement:1,className:"gstc-date-medium",format:({timeStart:t,className:e,vido:n})=>n.html`<span class="${e}-content gstc-date-bold">${t.format("DD")}</span> <span class="${e}-content gstc-date-thin">${t.format("dddd")}</span>`},{zoomTo:20,period:"day",default:!0,main:!0,periodIncrement:1,format:({timeStart:t,vido:e,className:n})=>e.html`<div class="${n}-content gstc-date-top">${t.format("DD")}</div><div class="${n}-content gstc-date-small">${t.format("dddd")}</div>`},{zoomTo:21,period:"day",main:!0,periodIncrement:1,format:({timeStart:t,vido:e,className:n})=>e.html`<div class="${n}-content gstc-date-top">${t.format("DD")}</div><div class="${n}-content gstc-date-small">${t.format("ddd")}</div>`},{zoomTo:22,period:"day",main:!0,periodIncrement:1,className:"gstc-date-vertical",format:({timeStart:t,className:e,vido:n})=>n.html`<div class="${e}-content gstc-date-top">${t.format("DD")}</div><div class="${e}-content gstc-date-extra-small">${t.format("ddd")}</div>`},{zoomTo:23,period:"week",default:!0,main:!0,periodIncrement:1,format:({timeStart:t,timeEnd:e,className:n,vido:i})=>i.html`<div class="${n}-content gstc-date-top">${t.format("DD")} - ${e.format("DD")}</div><div class="${n}-content gstc-date-small gstc-date-thin">${t.format("ddd")} - ${e.format("dd")}</div>`},{zoomTo:25,period:"week",main:!0,periodIncrement:1,className:"gstc-date-vertical",format:({timeStart:t,timeEnd:e,className:n,vido:i})=>i.html`<div class="${n}-content gstc-date-top gstc-date-small gstc-date-normal">${t.format("DD")}</div><div class="gstc-dash gstc-date-small">-</div><div class="${n}-content gstc-date-small gstc-date-normal">${e.format("DD")}</div>`},{zoomTo:26,period:"month",default:!0,main:!0,periodIncrement:1,className:"gstc-date-month-level-1",format:({timeStart:t,vido:e,className:n})=>e.html`<div class="${n}-content gstc-date-top">${t.format("MMM")}</div><div class="${n}-content gstc-date-small gstc-date-bottom">${t.format("MM")}</div>`},{zoomTo:27,period:"month",main:!0,periodIncrement:1,className:"gstc-date-vertical",format:({timeStart:t,className:e,vido:n})=>n.html`<div class="${e}-content gstc-date-top">${t.format("MM")}</div><div class="${e}-content gstc-date-extra-small">${t.format("MMM")}</div>`},{zoomTo:28,period:"year",default:!0,main:!0,periodIncrement:1,className:"gstc-date-big",format:({timeStart:t})=>t.format("YYYY")},{zoomTo:29,period:"year",main:!0,periodIncrement:1,className:"gstc-date-medium",format:({timeStart:t})=>t.format("YYYY")},{zoomTo:30,period:"year",main:!0,periodIncrement:1,className:"gstc-date-medium",format:({timeStart:t})=>t.format("YY")},{zoomTo:100,period:"year",main:!0,periodIncrement:1,default:!0,format:()=>null}]}]},grid:{cell:{onCreate:[]}},item:{gap:{top:4,bottom:4},top:0,height:32,minWidth:10,cutIcons:{left:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M20 9v6h-8v4.84L4.16 12L12 4.16V9h8z" fill="#ffffff"/><rect x="0" y="0" width="24" height="24" fill="rgba(0, 0, 0, 0)" /></svg>',right:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M4 15V9h8V4.16L19.84 12L12 19.84V15H4z" fill="#ffffff"/><rect x="0" y="0" width="24" height="24" fill="rgba(0, 0, 0, 0)" /></svg>'}},items:{},spacing:1},actions:generateEmptyActions(),locale:{name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekStart:1,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},ordinal:t=>{const e=["th","st","nd","rd"],n=t%100;return`[${t}${e[(n-20)%10]||e[n]||e[0]}]`}},utcMode:!1,merge:(t,e)=>B.mergeDeep({},t,e),useLast:!0,Promise:Promise,mute:[]}}(),i=function mergeActions(t,e,n){const i=n({},e.actions),s=n({},t.actions);let o=[...Object.keys(i),...Object.keys(s)];o=o.filter(t=>o.includes(t));const r={};for(const t of o)r[t]=[],void 0!==i[t]&&Array.isArray(i[t])&&(r[t]=[...i[t]]),void 0!==s[t]&&Array.isArray(s[t])&&(r[t]=[...r[t],...s[t]]);return delete t.actions,delete e.actions,r}(t,n,e),s={config:e(n,t)};return s.config.actions=i,s}const $t={name:wt,GSTCID:t=>`gstcid-${t}`,isGSTCID:t=>t.startsWith("gstcid-"),sourceID(t){return this.isGSTCID(t)?t.substr(7):t},stateFromConfig:function stateFromConfig(t){return this.state=new DeepState(prepareState(t),{delimeter:".",useMute:!0,maxSimultaneousJobs:1e3,Promise:t.Promise})},wasmStateFromConfig:function wasmStateFromConfig(t,e="./wildcard_matcher_bg.wasm"){return __awaiter(this,void 0,void 0,(function*(){return this.state=new DeepState(prepareState(t),{delimeter:".",useMute:!0,maxSimultaneousJobs:1e3}),yield this.state.loadWasmMatcher(e),this.state}))},merge:yt,lithtml:x,date:t=>t?dt(t):dt(),setPeriod(t){return this.state.update("config.chart.time.period",t),this.state.get("config.chart.time.zoom")},dayjs:dt};class Api{constructor(t){this.name=wt,this.debug=!1,this.plugins={},this.iconsCache={},this.unsubscribes=[],this.generateSlots=generateSlots,this.mergeDeep=yt,this.getClass=getClass,this.getId=getId,this.GSTCID=$t.GSTCID.bind(this),this.isGSTCID=$t.isGSTCID.bind(this),this.sourceID=$t.sourceID.bind(this),this.allActions=[],this.state=t,this.time=new Time(this.state,this),this.unsubscribes.push(this.state.subscribe("config.debug",t=>this.debug=t)),this.debug&&(window.state=t)}setVido(t){this.vido=t}log(...t){this.debug&&console.log.call(console,...t)}getActions(t){this.allActions.includes(t)||this.allActions.push(t);let e=this.state.get("config.actions."+t);return void 0===e&&(e=[]),e.slice()}isItemInViewport(t,e,n){if(!e||!n){const t=this.state.get("config.chart.time");e=t.leftGlobal,n=t.rightGlobal}return t.time.start<=n&&t.time.end>=e}getChildrenLinkedItemsIds(t,e,n=[]){const i=e[t];if(i.linkedWith&&i.linkedWith.length){n.includes(t)||n.push(t);for(const t of i.linkedWith){if(n.includes(t))continue;n.push(t);const i=e[t];i.linkedWith&&i.linkedWith.length&&this.getChildrenLinkedItemsIds(t,e,n)}}return n}collectAllLinkedItems(t,e){for(const n in t){const i=t[n];e[i.id].linkedWith=i.linkedWith||[]}const n=[];for(const t in e){if(n.includes(t))continue;const i=this.getChildrenLinkedItemsIds(t,e),s=Array.from(new Set([...e[t].linkedWith,...i]));e[t].linkedWith=[...s.filter(e=>e!==t)],n.includes(t)||n.push(t);for(const t of s)e[t].linkedWith=[...s.filter(e=>e!==t)],n.includes(t)||n.push(t)}}getChildrenDependantItemsIds(t,e,n=[]){if(t.dependant&&t.dependant.length)for(const i of t.dependant){if(n.includes(i))continue;n.push(i);const s=e[i];if(!s)throw new Error(`Dependant item not found [id:'${i}'] found in item [id:'${t.id}']`);s.dependant&&s.dependant.length&&this.getChildrenDependantItemsIds(s,e,n)}return n}getRow(t){return this.state.get(`config.list.rows.${t}`)}getRows(t){if(!t.length)return[];const e=this.getAllRows(),n=[];for(const i of t)e[i]&&n.push(e[i]);return n}getAllRows(){return this.state.get("config.list.rows")}getVisibleRowsId(){return this.state.get("$data.list.visibleRows")}getItem(t){return this.state.get(`config.chart.items.${t}`)}getItems(t=[]){const e=[],n=this.getAllItems();for(const i of t)n[i]&&e.push(n[i]);return e}getAllItems(){return this.state.get("config.chart.items")}getItemData(t){return this.state.get(`$data.chart.items.${t}`)}getItemsData(){return this.state.get("$data.chart.items")}setItemData(t,e){this.state.update(`$data.chart.items.${t}`,t=>{for(const n in e)t[n]=e[n];return t})}setItemsData(t){this.state.update("$data.chart.items",t)}prepareDependantItems(t,e){return this.getChildrenDependantItemsIds(t,e).filter(e=>e!==t.id)}prepareItems(t){const e=this.state.get("config.chart.item.height"),n=this.getItemsData();for(let i in t){const s=t[i];if(i=String(i),s.id=i,n[i])return t;n[s.id]||(n[s.id]={actualHeight:0,outerHeight:0,time:null,position:{left:0,actualLeft:0,right:0,actualRight:0,top:s.top||0,actualTop:s.top||0,viewTop:0},width:-1,actualWidth:-1,detached:!1,linkedWith:[],dependant:this.getChildrenDependantItemsIds(s,t)}),s.time.start=+s.time.start,s.time.end=+s.time.end,s.id=String(s.id);const o=this.state.get("config.chart.item");"number"!=typeof s.height&&(s.height=e),n[s.id].time={startDate:this.time.date(s.time.start),endDate:this.time.date(s.time.end)},n[s.id].actualHeight=s.height,"number"!=typeof s.top&&(s.top=0),s.gap||(s.gap={}),"number"!=typeof s.gap.top&&(s.gap.top=o.gap.top),"number"!=typeof s.gap.bottom&&(s.gap.bottom=o.gap.bottom),"number"!=typeof s.minWidth&&(s.minWidth=o.minWidth),n[s.id].outerHeight=n[s.id].actualHeight+s.gap.top+s.gap.bottom,n[s.id].position.actualTop=n[s.id].position.top+s.gap.top}return this.collectAllLinkedItems(t,n),this.setItemsData(n),t}sortRows(t){t.length&&t[0].$data&&t.sort((t,e)=>t.$data.children.includes(e.id)?-1:0);const e={};for(const n of t)e[n.id]=n;return e}fillEmptyRowValues(t){const e=this.state.get("config.list.row.height");let n=0;for(let i in t){const s=t[i];if(i=String(i),s.id=i,s.$data)return t;s.$data||(s.$data={parents:[],children:[],position:{top:0,topPercent:0,bottomPercent:0,viewTop:0},items:[],actualHeight:0,outerHeight:0}),"number"!=typeof s.height&&(s.height=e),s.$data.actualHeight=s.height,"boolean"!=typeof s.expanded&&(s.expanded=!1),s.$data.position.top=n,"object"!=typeof s.gap&&(s.gap={}),"number"!=typeof s.gap.top&&(s.gap.top=0),"number"!=typeof s.gap.bottom&&(s.gap.bottom=0),s.$data.outerHeight=s.$data.actualHeight+s.gap.top+s.gap.bottom,n+=s.$data.outerHeight}return t}itemsOnTheSameLevel(t,e){const n=this.getItemData(t.id),i=this.getItemData(e.id),s=n.position.top+n.outerHeight,o=i.position.top+i.outerHeight;return i.position.top<=n.position.top&&o>n.position.top||(i.position.top>=n.position.top&&i.position.top<s||i.position.top>=n.position.top&&o<s)}itemsOverlaps(t,e){return!!this.itemsOnTheSameLevel(t,e)&&(e.time.start>=t.time.start&&e.time.start<=t.time.end||(e.time.end>=t.time.start&&e.time.end<=t.time.end||(e.time.start>=t.time.start&&e.time.end<=t.time.end||e.time.start<=t.time.start&&e.time.end>=t.time.end)))}itemOverlapsWithOthers(t,e){for(let n=0,i=e.length;n<i;n++){const i=e[n],s=i.time.start&&t.time.start&&i.time.end&&t.time.end;if(t.id!==i.id&&this.itemsOverlaps(t,i)&&s)return i}return null}fixOverlappedItems(t){if(this.isMutedMethod("fixOverlapped"))return;if(0===t.length)return;let e=0;for(const n of t){const i=this.getItemData(n.id);i.position.top=n.top,i.position.actualTop=i.position.top+n.gap.top;let s=this.itemOverlapsWithOthers(n,t);if(e&&s){const e=this.getItemData(s.id);for(;s=this.itemOverlapsWithOthers(n,t);)i.position.top+=e.outerHeight,i.position.actualTop=i.position.top+n.gap.top}e++}}recalculateRowHeight(t){if(!t.$data)return 0;let e=0;const n=this.getItemsData(),i=this.getItems(t.$data.items);this.fixOverlappedItems(i);for(const t of i){const i=n[t.id];e=Math.max(e,i.position.top+i.outerHeight)}return e<t.height&&(e=t.height),t.$data.actualHeight=e,t.$data.outerHeight=t.$data.actualHeight+t.gap.top+t.gap.bottom,t.$data.outerHeight}recalculateRowsHeights(t){let e=0;const n=this.getAllRows();for(const i of t){const t=n[i];this.recalculateRowHeight(t),t.$data.position.top=e,e+=t.$data.outerHeight}return e}recalculateRowsPercents(t,e){let n=0;const i=this.getAllRows();for(const s of t){const t=i[s];e<=0?(t.$data.position.topPercent=0,t.$data.position.bottomPercent=0):(t.$data.position.topPercent=n?n/e:0,t.$data.position.bottomPercent=(n+t.$data.outerHeight)/e),n+=t.$data.outerHeight}}generateParents(t,e="parentId"){const n={};for(const i in t){const s=t[i],o=void 0!==s[e]&&null!==s[e]?s[e]:"";void 0===n[o]&&(n[o]={}),n[o][s.id]=s}return n}fastTree(t,e,n=[]){const i=t[e.id];if(e.$data.parents=n,void 0===i)return e.$data.children=[],e;""!==e.id&&(n=[...n,e.id]),e.$data.children=Object.values(i).map(t=>t.id);for(const e in i){const s=i[e];this.fastTree(t,s,n)}return e}makeTreeMap(t,e){const n=this.generateParents(e,"rowId");for(const e in t){if(!t[e].$data)return;if(t[e].$data.items.length=0,void 0!==n[e])for(const i of Object.values(n[e]))t[e].$data.items.push(i.id)}const i=this.generateParents(t);return this.fastTree(i,{id:"",$data:{children:[],parents:[],items:[]}})}getRowsWithParentsExpanded(t){const e=[];t:for(const n in t){if(!t[n].$data||!t[n].$data.parents)return[];for(const e of t[n].$data.parents){const n=t[e];if(!n||!n.expanded)continue t}e.push(n)}return e}getVisibleRows(t){if(this.debug&&console.log("getVisibleRows #1",{rowsWithParentsExpanded:t}),0===t.length)return[];const e=[],n=this.state.get("config.scroll.vertical");let i=n.data;this.debug&&console.log("getVisibleRows #2",{topRow:i}),i||(i=t[0]);let s=this.state.get("$data.innerHeight");if(this.debug&&console.log("getVisibleRows #3",{innerHeight:s}),!s)return[];const o=this.getAllRows();s+=n.offset||0;const r=t.find(t=>t===i.id);let a=t.indexOf(r);if(this.debug&&console.log("getVisibleRows #4",{index:a}),void 0===a)return[];let l=0;for(let n=t.length;a<n;a++){const n=t[a],i=o[n];if(!i||!i.$data)return this.debug&&console.log("getVisibleItems NO-ROW",{row:i,rowId:n,rows:o,index:a,rowsWithParentsExpanded:t}),[];if(l<=s&&(i.$data.position.viewTop=l,e.push(i.id)),l+=i.$data.outerHeight,l>=s)break}return this.debug&&console.log("getVisibleRows #5 final",{visibleRows:e,innerHeight:s,topRow:i,index:a}),e}getSortableValue(t,e){return"string"==typeof t?e[t]:"function"==typeof t?t({row:e,vido:this.vido}):""}sortRowsByColumn(t,e=!0){const n=this.state.get("config.list.sort.compare");this.state.update("config.list.rows",i=>{if(0===Object.keys(i).length)return i;const s=Object.values(i);return n?s.sort(n(t)):s.sort((n,i)=>{const s=this.getSortableValue(t.sortable,n),o=this.getSortableValue(t.sortable,i);return"number"==typeof s?e?s-o:o-s:"string"==typeof s?e?s.localeCompare(o):o.localeCompare(s):void 0}),this.sortRows(s)}),this.setScrollTop(0)}normalizeMouseWheelEvent(t){let e=t.deltaX||0,n=t.deltaY||0,i=t.deltaZ||0;const s=t.deltaMode,o=this.state.get("config.list.rowHeight");let r=1;switch(s){case 1:o&&(r=o);break;case 2:r=window.height}return e*=r,n*=r,i*=r,{x:e,y:n,z:i,event:t}}scrollToTime(t,e=!0,n=this.state.get("$data.chart.time")){if(!n.allDates)return 0;if(e){t-=this.state.get("$data.chart.dimensions.width")/2*n.timePerPixel}const i=this.time.findDateAtTime(t,n.allDates[n.level]),s=n.allDates[n.level].indexOf(i);return-1===s?0:this.setScrollLeft(s,n).posPx}setScrollLeft(t,e=this.state.get("$data.chart.time"),n,i="scroll"){void 0===t&&(t=0);let s=!0;void 0===n&&(s=!1,n=this.state.multi());const o=e.allDates[e.level];if(!o)return;const r=o[t];if(!r)return;let a;return n=n.update("config.scroll.horizontal",n=>{n.data=Object.assign({},r);const i=e.allDates[e.level].length-n.lastPageCount;t>i&&(t=i),n.dataIndex=t,n.posPx=this.time.calculateScrollPosPxFromTime(n.data.leftGlobal,e,n);const s=n.maxPosPx-n.innerSize;return n.posPx>s&&(n.posPx=s),a=n,n}),i&&(n=n.update("$data.chart.time.recalculateTimesLastReason",i)),s?n:(n.done(),a)}getScrollLeft(){return this.state.get("config.scroll.horizontal")}setScrollTop(t,e=0){void 0===t&&(t=0);const n=this.state.get("$data.list.rowsWithParentsExpanded"),i=this.getRows(n);i[t]||0===t||(t=0),i[t]&&this.state.update("config.scroll.vertical",n=>{const s=i.length-n.lastPageCount;return t+n.lastPageCount>i.length&&(t=s),t===s&&(e=0),n.data=i[t],n.offset=e,n.posPx=i[t].$data.position.topPercent*n.maxPosPx+Math.floor(n.scrollArea*(e/n.area)),n.dataIndex=t,n})}getScrollTop(){return this.state.get("config.scroll.vertical")}getGridCells(t){const e=this.state.get("$data.chart.grid.cells");if(!e)return[];if(void 0!==t){const n=[];for(const i in e){const s=e[i];t.includes(i)&&n.push(s)}return n}const n=[];for(const t in e){const i=e[t];n.push(i)}return n}getGridRows(t){const e=this.state.get("$data.chart.grid.rows");return void 0!==t?e?Object.values(e).filter(e=>t.includes(e.row.id)):[]:e?Object.values(e):[]}getGridCell(t){return this.state.get(`$data.chart.grid.cells.${t}`)}getGridRow(t){return this.state.get(`$data.chart.grid.rows.${t}`)}muteMethod(t){this.state.update("config.mute",e=>(e.includes(t)||e.push(t),e))}unmuteMethod(t){this.state.update("config.mute",e=>e.filter(e=>e!==t))}isMutedMethod(t){return this.state.get("config.mute").includes(t)}getSVGIconSrc(t){return"string"==typeof this.iconsCache[t]||(this.iconsCache[t]="data:image/svg+xml;base64,"+btoa(t)),this.iconsCache[t]}destroy(){for(const t of this.unsubscribes)t();this.unsubscribes=[],this.debug&&delete window.state}}function GSTC(t){const e=t.state,n=new Api(e),i={treeMap:{id:"",$data:{children:[],parents:[],items:[]}},list:{visibleRows:[],visibleRowsHeight:0,rowsWithParentsExpanded:[],rowsHeight:0,width:0},dimensions:{width:0,height:0},chart:{items:{},grid:{cells:{},rows:{}},dimensions:{width:0,innerWidth:0,height:0},visibleItems:[],time:{zoom:0,format:{period:"day",periodIncrement:1,zoomTo:0,format:()=>""},level:0,levels:[],timePerPixel:0,totalViewDurationMs:0,totalViewDurationPx:0,leftGlobal:0,rightGlobal:0,leftPx:0,rightPx:0,leftInner:0,rightInner:0,period:"day",leftGlobalDate:null,rightGlobalDate:null,centerGlobal:0,centerGlobalDate:null,from:0,to:0,fromDate:null,toDate:null,additionalSpaceAdded:!1}},elements:{}};"boolean"==typeof t.debug&&t.debug&&(window.state=e),e.update("",t=>({config:t.config,$data:i}));const s=Vido(e,n);n.setVido(s);const o=e.get("config.components.Main"),r=s.createApp({component:o,props:{},element:t.element}),a=r.vidoInstance.api;const l={state:e,api:a,component:r,destroy:function destroy(){r.destroy()},reload:function reload(){l.component.destroy();const n=e.get("config.components.Main");l.component=s.createApp({component:n,props:{},element:t.element}),l.api=r.vidoInstance.api,l.component.update()}};return l}GSTC.api=$t,t.Api=Api,t.DeepState=DeepState,t.default=GSTC,Object.defineProperty(t,"__esModule",{value:!0})}));
